2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3651 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6307 with IN_PROGRESS status for session sess_1759153993992_b4c32f90
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3651 with session sess_1759153994337_7dacda21
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994288_c9fd79df on flight 4013
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6307 and payment ID pay_56ed6c8400ac4362
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153993992_b4c32f90. payment ID: pay_56ed6c8400ac4362
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_56ed6c8400ac4362, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3182 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3182 with session sess_1759153994351_0438c15b
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4013
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994122_eea234fe on flight 2634
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4221, 5622, 2773], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153994377_88829cd8
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1734 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1734 with session sess_1759153994337_6f786347
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994041_8671a86c on flight 4591
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994272_33a8648c on flight 4109
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994114_6c8fdcc1 on flight 7429
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994328_257abdd5 on flight 3114
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_140b0b500f0541f4 across 1 flights for session sess_1759153994288_c9fd79df
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7429
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2634
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994087_4de37803 on flight 4452
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6308 with IN_PROGRESS status for session sess_1759153994288_c9fd79df
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_57fd4ef57d524586 across 3 flights for session sess_1759153994114_6c8fdcc1
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_90a61083d71143a4 across 3 flights for session sess_1759153994122_eea234fe
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6309 with IN_PROGRESS status for session sess_1759153994114_6c8fdcc1
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994193_2c266af2 on flight 7108
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6310 with IN_PROGRESS status for session sess_1759153994122_eea234fe
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994197_fc50021b on flight 6717
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994243_c715685f on flight 2657
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994337_7dacda21 on flight 3651
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4109
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2184 (leg 2/2)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6308 and payment ID pay_140b0b500f0541f4
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994288_c9fd79df. payment ID: pay_140b0b500f0541f4
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4591
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4452
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_140b0b500f0541f4, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3114
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2184 with session sess_1759153994272_33a8648c
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994117_c9494f7b on flight 6373
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6309 and payment ID pay_57fd4ef57d524586
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994114_6c8fdcc1. payment ID: pay_57fd4ef57d524586
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_edcdd5a9e8fd4d15 across 3 flights for session sess_1759153994041_8671a86c
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994351_0438c15b on flight 3182
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_57fd4ef57d524586, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8d3ed55f39c24b24 across 3 flights for session sess_1759153994087_4de37803
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a84ff561761043a2 across 1 flights for session sess_1759153994328_257abdd5
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6310 and payment ID pay_90a61083d71143a4
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994122_eea234fe. payment ID: pay_90a61083d71143a4
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_90a61083d71143a4, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7108
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1742 (leg 2/2)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6717
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6311 with IN_PROGRESS status for session sess_1759153994087_4de37803
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6313 with IN_PROGRESS status for session sess_1759153994041_8671a86c
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6312 with IN_PROGRESS status for session sess_1759153994328_257abdd5
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3651
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2657
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1742 with session sess_1759153994193_2c266af2
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_24b31d593c5e4846 across 2 flights for session sess_1759153994197_fc50021b
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[968, 135, 4543], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153994441_a411830e
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994337_6f786347 on flight 1734
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6811, 5311, 1404], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153994443_93c50e6e
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9c55ac2a27814995 across 2 flights for session sess_1759153994243_c715685f
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5532, 3904, 1290], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153994446_ad13a67c
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8ad3a69e2cee4988 across 1 flights for session sess_1759153994337_7dacda21
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6314 with IN_PROGRESS status for session sess_1759153994197_fc50021b
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6315 with IN_PROGRESS status for session sess_1759153994243_c715685f
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6373
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3182
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6312 and payment ID pay_a84ff561761043a2
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994328_257abdd5. payment ID: pay_a84ff561761043a2
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6311 and payment ID pay_8d3ed55f39c24b24
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994087_4de37803. payment ID: pay_8d3ed55f39c24b24
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8d3ed55f39c24b24, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a84ff561761043a2, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6316 with IN_PROGRESS status for session sess_1759153994337_7dacda21
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6313 and payment ID pay_edcdd5a9e8fd4d15
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994041_8671a86c. payment ID: pay_edcdd5a9e8fd4d15
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_db270a8016a54224 across 3 flights for session sess_1759153994117_c9494f7b
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_edcdd5a9e8fd4d15, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c9de06727b67404e across 1 flights for session sess_1759153994351_0438c15b
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6317 with IN_PROGRESS status for session sess_1759153994117_c9494f7b
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1734
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 965 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994272_33a8648c on flight 2184
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6318 with IN_PROGRESS status for session sess_1759153994351_0438c15b
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6314 and payment ID pay_24b31d593c5e4846
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994197_fc50021b. payment ID: pay_24b31d593c5e4846
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6315 and payment ID pay_9c55ac2a27814995
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994243_c715685f. payment ID: pay_9c55ac2a27814995
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_24b31d593c5e4846, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9c55ac2a27814995, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7588, 6843, 4452], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153994471_3ac47558
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1393, 4165, 1646], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6316 and payment ID pay_8ad3a69e2cee4988
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994337_7dacda21. payment ID: pay_8ad3a69e2cee4988
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 965 with session sess_1759153994337_6f786347
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153994472_7cffc41c
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8ad3a69e2cee4988, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4221 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3700], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153994474_9f1f1ba7
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994193_2c266af2 on flight 1742
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6318 and payment ID pay_c9de06727b67404e
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994351_0438c15b. payment ID: pay_c9de06727b67404e
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c9de06727b67404e, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2184
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5780, 1903], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1833, 1085], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153994482_de6a31f9
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153994481_121d4fd3
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ffcdec050173421d across 2 flights for session sess_1759153994272_33a8648c
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3062, 5885, 3481], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6317 and payment ID pay_db270a8016a54224
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994117_c9494f7b. payment ID: pay_db270a8016a54224
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_db270a8016a54224, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153994486_26eb6902
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1742
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4221 with session sess_1759153994377_88829cd8
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6319 with IN_PROGRESS status for session sess_1759153994272_33a8648c
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d09e9f974e6845e4 across 2 flights for session sess_1759153994193_2c266af2
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3520, 3959], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153994494_e6216258
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3700 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3700 with session sess_1759153994474_9f1f1ba7
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3884], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6320 with IN_PROGRESS status for session sess_1759153994193_2c266af2
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153994500_acda2009
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 968 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6811 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 968 with session sess_1759153994441_a411830e
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994337_6f786347 on flight 965
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6319 and payment ID pay_ffcdec050173421d
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994272_33a8648c. payment ID: pay_ffcdec050173421d
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ffcdec050173421d, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6811 with session sess_1759153994443_93c50e6e
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6320 and payment ID pay_d09e9f974e6845e4
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994193_2c266af2. payment ID: pay_d09e9f974e6845e4
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d09e9f974e6845e4, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1349], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153994528_9c04807f
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3884 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5780 (leg 1/2)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6811], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153994540_08b23adb
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5780 with session sess_1759153994481_121d4fd3
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994377_88829cd8 on flight 4221
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1833 (leg 1/2)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3884 with session sess_1759153994500_acda2009
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5532 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 965
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1680 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1833 with session sess_1759153994482_de6a31f9
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1393 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994474_9f1f1ba7 on flight 3700
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7588 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3520 (leg 1/2)
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1680 with session sess_1759153994337_6f786347
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5532 with session sess_1759153994446_ad13a67c
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1349 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7588 with session sess_1759153994471_3ac47558
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1393 with session sess_1759153994472_7cffc41c
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3520 with session sess_1759153994494_e6216258
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1349 with session sess_1759153994528_9c04807f
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4221
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5622 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5622 with session sess_1759153994377_88829cd8
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6811 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6811 with session sess_1759153994540_08b23adb
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994446_ad13a67c on flight 5532
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3062 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3062 with session sess_1759153994486_26eb6902
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994377_88829cd8 on flight 5622
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994441_a411830e on flight 968
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994500_acda2009 on flight 3884
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994337_6f786347 on flight 1680
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5622
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2773 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3884
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5532
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3904 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 968
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 135 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994481_121d4fd3 on flight 5780
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e434c86c0b514687 across 1 flights for session sess_1759153994500_acda2009
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 135 with session sess_1759153994441_a411830e
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3904 with session sess_1759153994446_ad13a67c
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994443_93c50e6e on flight 6811
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994482_de6a31f9 on flight 1833
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994472_7cffc41c on flight 1393
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2773 with session sess_1759153994377_88829cd8
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6321 with IN_PROGRESS status for session sess_1759153994500_acda2009
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994494_e6216258 on flight 3520
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1393
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4165 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5780
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1903 (leg 2/2)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3520
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3959 (leg 2/2)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6321 and payment ID pay_e434c86c0b514687
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994500_acda2009. payment ID: pay_e434c86c0b514687
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e434c86c0b514687, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1680
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3700
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6811
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5311 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5311 with session sess_1759153994443_93c50e6e
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1903 with session sess_1759153994481_121d4fd3
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4165 with session sess_1759153994472_7cffc41c
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3959 with session sess_1759153994494_e6216258
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7653a0f3f3354ebb across 3 flights for session sess_1759153994337_6f786347
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f2e3f8d704eb475c across 1 flights for session sess_1759153994474_9f1f1ba7
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1660, 4299, 7681], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153994681_bd0ada2c
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994486_26eb6902 on flight 3062
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6322 with IN_PROGRESS status for session sess_1759153994474_9f1f1ba7
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1833
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1085 (leg 2/2)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994528_9c04807f on flight 1349
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1085 with session sess_1759153994482_de6a31f9
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994540_08b23adb on flight 6811
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994441_a411830e on flight 135
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3062
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5885 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1349
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5885 with session sess_1759153994486_26eb6902
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7792021bbd684411 across 1 flights for session sess_1759153994528_9c04807f
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6324 with IN_PROGRESS status for session sess_1759153994528_9c04807f
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994471_3ac47558 on flight 7588
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6322 and payment ID pay_f2e3f8d704eb475c
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994474_9f1f1ba7. payment ID: pay_f2e3f8d704eb475c
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f2e3f8d704eb475c, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 135
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6811
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6323 with IN_PROGRESS status for session sess_1759153994337_6f786347
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4543 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6324 and payment ID pay_7792021bbd684411
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994528_9c04807f. payment ID: pay_7792021bbd684411
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7792021bbd684411, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b9e70c6edf4f4204 across 1 flights for session sess_1759153994540_08b23adb
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4543 with session sess_1759153994441_a411830e
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7588
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6843 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6325 with IN_PROGRESS status for session sess_1759153994540_08b23adb
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994446_ad13a67c on flight 3904
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994482_de6a31f9 on flight 1085
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6843 with session sess_1759153994471_3ac47558
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994494_e6216258 on flight 3959
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4060, 2985], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153994713_bfb22689
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4029], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153994715_b82a3d01
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6323 and payment ID pay_7653a0f3f3354ebb
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994337_6f786347. payment ID: pay_7653a0f3f3354ebb
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7653a0f3f3354ebb, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994377_88829cd8 on flight 2773
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6325 and payment ID pay_b9e70c6edf4f4204
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994540_08b23adb. payment ID: pay_b9e70c6edf4f4204
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b9e70c6edf4f4204, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4029 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3904
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1290 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7980], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153994730_efa8ae58
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1290 with session sess_1759153994446_ad13a67c
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4276], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153994733_3bf9e45c
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2773
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1660 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4029 with session sess_1759153994715_b82a3d01
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f1619e7823d546b3 across 3 flights for session sess_1759153994377_88829cd8
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1660 with session sess_1759153994681_bd0ada2c
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1085
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6326 with IN_PROGRESS status for session sess_1759153994377_88829cd8
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4060 (leg 1/2)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4276 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7980 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4060 with session sess_1759153994713_bfb22689
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994441_a411830e on flight 4543
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4276 with session sess_1759153994733_3bf9e45c
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7980 with session sess_1759153994730_efa8ae58
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6326 and payment ID pay_f1619e7823d546b3
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_640aa5d7b0ad4693 across 2 flights for session sess_1759153994482_de6a31f9
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994377_88829cd8. payment ID: pay_f1619e7823d546b3
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994471_3ac47558 on flight 6843
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f1619e7823d546b3, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3959
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_39e77fa7424d4995 across 2 flights for session sess_1759153994494_e6216258
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994472_7cffc41c on flight 4165
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1076], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153994780_e53d8326
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6327 with IN_PROGRESS status for session sess_1759153994482_de6a31f9
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994443_93c50e6e on flight 5311
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6843
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4452 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4452 with session sess_1759153994471_3ac47558
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4543
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6327 and payment ID pay_640aa5d7b0ad4693
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994482_de6a31f9. payment ID: pay_640aa5d7b0ad4693
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_07ecc755c34b4820 across 3 flights for session sess_1759153994441_a411830e
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_640aa5d7b0ad4693, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994486_26eb6902 on flight 5885
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4165
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1646 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1076 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994481_121d4fd3 on flight 1903
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6329 with IN_PROGRESS status for session sess_1759153994441_a411830e
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5311
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6328 with IN_PROGRESS status for session sess_1759153994494_e6216258
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1404 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1076 with session sess_1759153994780_e53d8326
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1646 with session sess_1759153994472_7cffc41c
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[406, 1562, 3885], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6329 and payment ID pay_07ecc755c34b4820
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994441_a411830e. payment ID: pay_07ecc755c34b4820
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153994804_637c9c10
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_07ecc755c34b4820, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1404 with session sess_1759153994443_93c50e6e
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5885
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3481 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1903
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3481 with session sess_1759153994486_26eb6902
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994681_bd0ada2c on flight 1660
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994733_3bf9e45c on flight 4276
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_72669e89d42741d6 across 2 flights for session sess_1759153994481_121d4fd3
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994446_ad13a67c on flight 1290
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6328 and payment ID pay_39e77fa7424d4995
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994494_e6216258. payment ID: pay_39e77fa7424d4995
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_39e77fa7424d4995, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6330 with IN_PROGRESS status for session sess_1759153994481_121d4fd3
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1660
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4299 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4299 with session sess_1759153994681_bd0ada2c
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4565, 3518, 1136], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153994817_25e038e0
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1290
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6330 and payment ID pay_72669e89d42741d6
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994481_121d4fd3. payment ID: pay_72669e89d42741d6
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4276
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_72669e89d42741d6, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994471_3ac47558 on flight 4452
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7745, 1966, 6522], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153994825_3a46398f
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0374b0435e9f48c2 across 3 flights for session sess_1759153994446_ad13a67c
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f0aab72b051d4324 across 1 flights for session sess_1759153994733_3bf9e45c
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6331 with IN_PROGRESS status for session sess_1759153994446_ad13a67c
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4452
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6332 with IN_PROGRESS status for session sess_1759153994733_3bf9e45c
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6443, 963, 4782], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153994839_1e5606ee
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_54d89e29ef884d5c across 3 flights for session sess_1759153994471_3ac47558
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994443_93c50e6e on flight 1404
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6333 with IN_PROGRESS status for session sess_1759153994471_3ac47558
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 406 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994715_b82a3d01 on flight 4029
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 406 with session sess_1759153994804_637c9c10
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6331 and payment ID pay_0374b0435e9f48c2
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994446_ad13a67c. payment ID: pay_0374b0435e9f48c2
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994472_7cffc41c on flight 1646
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0374b0435e9f48c2, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6332 and payment ID pay_f0aab72b051d4324
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994733_3bf9e45c. payment ID: pay_f0aab72b051d4324
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f0aab72b051d4324, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6333 and payment ID pay_54d89e29ef884d5c
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994471_3ac47558. payment ID: pay_54d89e29ef884d5c
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_54d89e29ef884d5c, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1646
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a400ec33c3744b2f across 3 flights for session sess_1759153994472_7cffc41c
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4565 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4029
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[623, 5273, 5672], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153994873_5917ae90
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1404
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6334 with IN_PROGRESS status for session sess_1759153994472_7cffc41c
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4738], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153994878_f4ef8313
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4565 with session sess_1759153994817_25e038e0
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[580, 3427], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153994881_2a0c3e62
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6105326856b64bb4 across 1 flights for session sess_1759153994715_b82a3d01
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6b65f99f564b4a2a across 3 flights for session sess_1759153994443_93c50e6e
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6335 with IN_PROGRESS status for session sess_1759153994715_b82a3d01
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6443 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6334 and payment ID pay_a400ec33c3744b2f
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994472_7cffc41c. payment ID: pay_a400ec33c3744b2f
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6443 with session sess_1759153994839_1e5606ee
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a400ec33c3744b2f, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4738 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7745 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4738 with session sess_1759153994878_f4ef8313
2025-09-29 19:23:14 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7745 with session sess_1759153994825_3a46398f
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1685, 1556, 1026], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153994921_1fdb2897
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994713_bfb22689 on flight 4060
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6335 and payment ID pay_6105326856b64bb4
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994715_b82a3d01. payment ID: pay_6105326856b64bb4
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6105326856b64bb4, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994681_bd0ada2c on flight 4299
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4060
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2985 (leg 2/2)
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2985 with session sess_1759153994713_bfb22689
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994486_26eb6902 on flight 3481
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994817_25e038e0 on flight 4565
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6336 with IN_PROGRESS status for session sess_1759153994443_93c50e6e
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4299
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7681 (leg 3/3)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6658], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153994938_794f3d57
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994730_efa8ae58 on flight 7980
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7681 with session sess_1759153994681_bd0ada2c
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 623 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6658 (leg 1/1)
2025-09-29 19:23:14 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6658 with session sess_1759153994938_794f3d57
2025-09-29 19:23:14 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4565
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3518 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3481
2025-09-29 19:23:14 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 623 with session sess_1759153994873_5917ae90
2025-09-29 19:23:14 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6336 and payment ID pay_6b65f99f564b4a2a
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994443_93c50e6e. payment ID: pay_6b65f99f564b4a2a
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6b65f99f564b4a2a, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994804_637c9c10 on flight 406
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3518 with session sess_1759153994817_25e038e0
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 580 (leg 1/2)
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8c04f38c66584cc2 across 3 flights for session sess_1759153994486_26eb6902
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 580 with session sess_1759153994881_2a0c3e62
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6337 with IN_PROGRESS status for session sess_1759153994486_26eb6902
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994839_1e5606ee on flight 6443
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7980
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1685 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_695d0871c6764767 across 1 flights for session sess_1759153994730_efa8ae58
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5971, 1587, 3548], seatCount=3)]
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153994965_be65205f
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6337 and payment ID pay_8c04f38c66584cc2
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994486_26eb6902. payment ID: pay_8c04f38c66584cc2
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1685 with session sess_1759153994921_1fdb2897
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8c04f38c66584cc2, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 406
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1562 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6338 with IN_PROGRESS status for session sess_1759153994730_efa8ae58
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1562 with session sess_1759153994804_637c9c10
2025-09-29 19:23:14 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6443
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 963 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 963 with session sess_1759153994839_1e5606ee
2025-09-29 19:23:14 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6338 and payment ID pay_695d0871c6764767
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994730_efa8ae58. payment ID: pay_695d0871c6764767
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994713_bfb22689 on flight 2985
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_695d0871c6764767, fli (truncated)...]
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994825_3a46398f on flight 7745
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994780_e53d8326 on flight 1076
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4352, 6141], seatCount=2)]
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153994979_3b74f3ea
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7745
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1966 (leg 2/3)
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1076
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2985
2025-09-29 19:23:14 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1966 with session sess_1759153994825_3a46398f
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b7e65b024ea14d7d across 2 flights for session sess_1759153994713_bfb22689
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_379ecb5105934b3d across 1 flights for session sess_1759153994780_e53d8326
2025-09-29 19:23:14 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[810], seatCount=1)]
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:14 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153994989_87ea70af
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6339 with IN_PROGRESS status for session sess_1759153994780_e53d8326
2025-09-29 19:23:14 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994817_25e038e0 on flight 3518
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5971 (leg 1/3)
2025-09-29 19:23:14 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:14 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5971 with session sess_1759153994965_be65205f
2025-09-29 19:23:14 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:14 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:14 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6340 with IN_PROGRESS status for session sess_1759153994713_bfb22689
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3518
2025-09-29 19:23:14 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1136 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4352 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6339 and payment ID pay_379ecb5105934b3d
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994780_e53d8326. payment ID: pay_379ecb5105934b3d
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_379ecb5105934b3d, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4352 with session sess_1759153994979_3b74f3ea
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1136 with session sess_1759153994817_25e038e0
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 810 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 810 with session sess_1759153994989_87ea70af
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6340 and payment ID pay_b7e65b024ea14d7d
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994713_bfb22689. payment ID: pay_b7e65b024ea14d7d
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b7e65b024ea14d7d, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994681_bd0ada2c on flight 7681
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994873_5917ae90 on flight 623
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5593, 5836, 7890], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995013_7b4eec8c
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1197, 7096, 2650], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995019_50ffe2de
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7681
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994825_3a46398f on flight 1966
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994938_794f3d57 on flight 6658
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994878_f4ef8313 on flight 4738
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994881_2a0c3e62 on flight 580
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8f84ecd9d5c54c81 across 3 flights for session sess_1759153994681_bd0ada2c
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994921_1fdb2897 on flight 1685
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6341 with IN_PROGRESS status for session sess_1759153994681_bd0ada2c
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 623
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5273 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994989_87ea70af on flight 810
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994817_25e038e0 on flight 1136
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1966
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6522 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5273 with session sess_1759153994873_5917ae90
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994979_3b74f3ea on flight 4352
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994804_637c9c10 on flight 1562
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6522 with session sess_1759153994825_3a46398f
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6658
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 580
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3427 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3427 with session sess_1759153994881_2a0c3e62
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a8322f1c53a94e64 across 1 flights for session sess_1759153994938_794f3d57
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4738
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1685
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1556 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1136
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c0dab4646ddb4759 across 1 flights for session sess_1759153994878_f4ef8313
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 810
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1562
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3885 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1556 with session sess_1759153994921_1fdb2897
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994965_be65205f on flight 5971
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3885 with session sess_1759153994804_637c9c10
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6342 with IN_PROGRESS status for session sess_1759153994878_f4ef8313
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6343 with IN_PROGRESS status for session sess_1759153994938_794f3d57
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1197 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4c1dc8397ea149f2 across 1 flights for session sess_1759153994989_87ea70af
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5b6df238ec2541dd across 3 flights for session sess_1759153994817_25e038e0
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1197 with session sess_1759153995019_50ffe2de
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6341 and payment ID pay_8f84ecd9d5c54c81
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6344 with IN_PROGRESS status for session sess_1759153994817_25e038e0
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994681_bd0ada2c. payment ID: pay_8f84ecd9d5c54c81
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8f84ecd9d5c54c81, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6345 with IN_PROGRESS status for session sess_1759153994989_87ea70af
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4352
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6342 and payment ID pay_c0dab4646ddb4759
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6141 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994878_f4ef8313. payment ID: pay_c0dab4646ddb4759
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5971
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1587 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c0dab4646ddb4759, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1587 with session sess_1759153994965_be65205f
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6141 with session sess_1759153994979_3b74f3ea
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2061, 5648, 7462], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995091_bce8a4e9
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6046], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153995097_905f1ec5
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6343 and payment ID pay_a8322f1c53a94e64
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994938_794f3d57. payment ID: pay_a8322f1c53a94e64
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a8322f1c53a94e64, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994825_3a46398f on flight 6522
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6344 and payment ID pay_5b6df238ec2541dd
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6345 and payment ID pay_4c1dc8397ea149f2
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994817_25e038e0. payment ID: pay_5b6df238ec2541dd
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994989_87ea70af. payment ID: pay_4c1dc8397ea149f2
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5b6df238ec2541dd, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4c1dc8397ea149f2, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2199], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153995131_9d404a94
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7564, 1523], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2868, 344, 7623], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995143_df3e4069
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995144_c27963ae
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5593 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6522
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994804_637c9c10 on flight 3885
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994881_2a0c3e62 on flight 3427
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5593 with session sess_1759153995013_7b4eec8c
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4c6ff61082b74fb8 across 3 flights for session sess_1759153994825_3a46398f
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2199 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995019_50ffe2de on flight 1197
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6046 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6346 with IN_PROGRESS status for session sess_1759153994825_3a46398f
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994921_1fdb2897 on flight 1556
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3885
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2199 with session sess_1759153995131_9d404a94
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6046 with session sess_1759153995097_905f1ec5
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994965_be65205f on flight 1587
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7e5d1d8243234520 across 3 flights for session sess_1759153994804_637c9c10
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1197
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7096 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6347 with IN_PROGRESS status for session sess_1759153994804_637c9c10
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6346 and payment ID pay_4c6ff61082b74fb8
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994825_3a46398f. payment ID: pay_4c6ff61082b74fb8
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4c6ff61082b74fb8, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7564 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994873_5917ae90 on flight 5273
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7096 with session sess_1759153995019_50ffe2de
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7564 with session sess_1759153995144_c27963ae
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994839_1e5606ee on flight 963
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1587
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3548 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6459], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153995197_db349360
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3548 with session sess_1759153994965_be65205f
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5273
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5672 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994979_3b74f3ea on flight 6141
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5672 with session sess_1759153994873_5917ae90
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6347 and payment ID pay_7e5d1d8243234520
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994804_637c9c10. payment ID: pay_7e5d1d8243234520
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7e5d1d8243234520, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3427
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6459 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2061 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_471b2a832c5c4cec across 2 flights for session sess_1759153994881_2a0c3e62
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2868 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6459 with session sess_1759153995197_db349360
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2061 with session sess_1759153995091_bce8a4e9
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6141
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[466, 7940], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995219_c512d80b
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1556
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1026 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2868 with session sess_1759153995143_df3e4069
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6348 with IN_PROGRESS status for session sess_1759153994881_2a0c3e62
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 963
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4782 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_18c52989cfca44b1 across 2 flights for session sess_1759153994979_3b74f3ea
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4782 with session sess_1759153994839_1e5606ee
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1026 with session sess_1759153994921_1fdb2897
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6349 with IN_PROGRESS status for session sess_1759153994979_3b74f3ea
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6348 and payment ID pay_471b2a832c5c4cec
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994881_2a0c3e62. payment ID: pay_471b2a832c5c4cec
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_471b2a832c5c4cec, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995131_9d404a94 on flight 2199
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6349 and payment ID pay_18c52989cfca44b1
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994979_3b74f3ea. payment ID: pay_18c52989cfca44b1
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_18c52989cfca44b1, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995019_50ffe2de on flight 7096
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2367, 307], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153995248_a86f03fe
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995097_905f1ec5 on flight 6046
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7096
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2650 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7825, 575, 6061], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995256_7ff46328
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2650 with session sess_1759153995019_50ffe2de
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6046
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e1061a4421054973 across 1 flights for session sess_1759153995097_905f1ec5
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 466 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6350 with IN_PROGRESS status for session sess_1759153995097_905f1ec5
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2199
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995144_c27963ae on flight 7564
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153994873_5917ae90 on flight 5672
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995197_db349360 on flight 6459
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 466 with session sess_1759153995219_c512d80b
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2367 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2367 with session sess_1759153995248_a86f03fe
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7564
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1523 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994965_be65205f on flight 3548
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5672
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995143_df3e4069 on flight 2868
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153994921_1fdb2897 on flight 1026
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995019_50ffe2de on flight 2650
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8b7da9bb74474f08 across 1 flights for session sess_1759153995131_9d404a94
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1523 with session sess_1759153995144_c27963ae
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6350 and payment ID pay_e1061a4421054973
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995097_905f1ec5. payment ID: pay_e1061a4421054973
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e1061a4421054973, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c1db68ae7e0647c5 across 3 flights for session sess_1759153994873_5917ae90
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995091_bce8a4e9 on flight 2061
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995013_7b4eec8c on flight 5593
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6351 with IN_PROGRESS status for session sess_1759153995131_9d404a94
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6352 with IN_PROGRESS status for session sess_1759153994873_5917ae90
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6459
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2868
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 344 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b3c2cf993c16465a across 1 flights for session sess_1759153995197_db349360
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1026
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 344 with session sess_1759153995143_df3e4069
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3548
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1094], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995313_1b8584d3
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2650
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6fc2b5a8840640f4 across 3 flights for session sess_1759153994965_be65205f
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7825 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6353 with IN_PROGRESS status for session sess_1759153995197_db349360
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4a1c0e6c9b3c4033 across 3 flights for session sess_1759153994921_1fdb2897
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5593
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6351 and payment ID pay_8b7da9bb74474f08
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5836 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995131_9d404a94. payment ID: pay_8b7da9bb74474f08
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8b7da9bb74474f08, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7825 with session sess_1759153995256_7ff46328
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e7429d4a134347b4 across 3 flights for session sess_1759153995019_50ffe2de
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2061
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5648 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6354 with IN_PROGRESS status for session sess_1759153994965_be65205f
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5836 with session sess_1759153995013_7b4eec8c
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6355 with IN_PROGRESS status for session sess_1759153994921_1fdb2897
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6381, 6304], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995331_27c76f63
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6352 and payment ID pay_c1db68ae7e0647c5
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994873_5917ae90. payment ID: pay_c1db68ae7e0647c5
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c1db68ae7e0647c5, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5648 with session sess_1759153995091_bce8a4e9
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6356 with IN_PROGRESS status for session sess_1759153995019_50ffe2de
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1094 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6353 and payment ID pay_b3c2cf993c16465a
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995197_db349360. payment ID: pay_b3c2cf993c16465a
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b3c2cf993c16465a, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3177], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153995348_7e641c8d
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1094 with session sess_1759153995313_1b8584d3
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995248_a86f03fe on flight 2367
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6354 and payment ID pay_6fc2b5a8840640f4
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994965_be65205f. payment ID: pay_6fc2b5a8840640f4
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6fc2b5a8840640f4, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4949, 2643, 191], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153995360_bfc4cf18
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995144_c27963ae on flight 1523
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995219_c512d80b on flight 466
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153994839_1e5606ee on flight 4782
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3177 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6355 and payment ID pay_4a1c0e6c9b3c4033
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994921_1fdb2897. payment ID: pay_4a1c0e6c9b3c4033
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4a1c0e6c9b3c4033, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7268], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153995372_5c306348
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3177 with session sess_1759153995348_7e641c8d
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1523
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995143_df3e4069 on flight 344
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2367
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 307 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6356 and payment ID pay_e7429d4a134347b4
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995019_50ffe2de. payment ID: pay_e7429d4a134347b4
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e7429d4a134347b4, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 307 with session sess_1759153995248_a86f03fe
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 466
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6381 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7940 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995256_7ff46328 on flight 7825
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a19cff244fd0456f across 2 flights for session sess_1759153995144_c27963ae
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1959], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153995386_7825c387
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7940 with session sess_1759153995219_c512d80b
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6381 with session sess_1759153995331_27c76f63
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7268 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995313_1b8584d3 on flight 1094
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2803, 1920, 2845], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995391_4da6e0ea
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7268 with session sess_1759153995372_5c306348
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995091_bce8a4e9 on flight 5648
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4782
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6357 with IN_PROGRESS status for session sess_1759153995144_c27963ae
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a42e9d80027d424c across 3 flights for session sess_1759153994839_1e5606ee
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 344
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7623 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7623 with session sess_1759153995143_df3e4069
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6357 and payment ID pay_a19cff244fd0456f
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995144_c27963ae. payment ID: pay_a19cff244fd0456f
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a19cff244fd0456f, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995348_7e641c8d on flight 3177
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5648
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7462 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1094
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6358 with IN_PROGRESS status for session sess_1759153994839_1e5606ee
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7825
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 575 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_cbc6905caaa84576 across 1 flights for session sess_1759153995313_1b8584d3
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4949 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 575 with session sess_1759153995256_7ff46328
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7462 with session sess_1759153995091_bce8a4e9
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6359 with IN_PROGRESS status for session sess_1759153995313_1b8584d3
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1959 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1959 with session sess_1759153995386_7825c387
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3177
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4949 with session sess_1759153995360_bfc4cf18
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6178, 3447], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995419_c3f7a123
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d1f3a591bd7c49da across 1 flights for session sess_1759153995348_7e641c8d
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6359 and payment ID pay_cbc6905caaa84576
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6360 with IN_PROGRESS status for session sess_1759153995348_7e641c8d
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995313_1b8584d3. payment ID: pay_cbc6905caaa84576
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_cbc6905caaa84576, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6358 and payment ID pay_a42e9d80027d424c
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153994839_1e5606ee. payment ID: pay_a42e9d80027d424c
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a42e9d80027d424c, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6360 and payment ID pay_d1f3a591bd7c49da
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995348_7e641c8d. payment ID: pay_d1f3a591bd7c49da
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d1f3a591bd7c49da, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[956, 2633], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995440_999aa297
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995013_7b4eec8c on flight 5836
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995091_bce8a4e9 on flight 7462
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2803 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7424, 2538, 2057], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995446_e47fd2db
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1787, 7884], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153995446_e6034db0
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995248_a86f03fe on flight 307
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2803 with session sess_1759153995391_4da6e0ea
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995386_7825c387 on flight 1959
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995256_7ff46328 on flight 575
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 307
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 575
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6061 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 956 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_28a6aaf7e59d45c2 across 2 flights for session sess_1759153995248_a86f03fe
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7462
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6361 with IN_PROGRESS status for session sess_1759153995248_a86f03fe
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995143_df3e4069 on flight 7623
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6061 with session sess_1759153995256_7ff46328
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1959
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f33b1d6854fa4623 across 1 flights for session sess_1759153995386_7825c387
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5836
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7890 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 956 with session sess_1759153995440_999aa297
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_fa88c9c84e114675 across 3 flights for session sess_1759153995091_bce8a4e9
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6362 with IN_PROGRESS status for session sess_1759153995091_bce8a4e9
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6178 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6178 with session sess_1759153995419_c3f7a123
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995360_bfc4cf18 on flight 4949
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7623
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6363 with IN_PROGRESS status for session sess_1759153995386_7825c387
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d4bf695dace44029 across 3 flights for session sess_1759153995143_df3e4069
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1787 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4949
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6361 and payment ID pay_28a6aaf7e59d45c2
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2643 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995248_a86f03fe. payment ID: pay_28a6aaf7e59d45c2
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_28a6aaf7e59d45c2, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2643 with session sess_1759153995360_bfc4cf18
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6364 with IN_PROGRESS status for session sess_1759153995143_df3e4069
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6363 and payment ID pay_f33b1d6854fa4623
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995386_7825c387. payment ID: pay_f33b1d6854fa4623
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f33b1d6854fa4623, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6362 and payment ID pay_fa88c9c84e114675
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995091_bce8a4e9. payment ID: pay_fa88c9c84e114675
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_fa88c9c84e114675, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5524], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995505_85af98bf
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6523, 7809, 7718], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995509_407d2d66
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5530, 7555, 6749], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153995511_1946ae4e
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995391_4da6e0ea on flight 2803
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7890 with session sess_1759153995013_7b4eec8c
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1787 with session sess_1759153995446_e6034db0
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995256_7ff46328 on flight 6061
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6364 and payment ID pay_d4bf695dace44029
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995143_df3e4069. payment ID: pay_d4bf695dace44029
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d4bf695dace44029, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2803
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1920 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5524 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3371, 3754, 6095], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153995540_5a4d5939
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995331_27c76f63 on flight 6381
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995219_c512d80b on flight 7940
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6061
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995372_5c306348 on flight 7268
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995360_bfc4cf18 on flight 2643
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5524 with session sess_1759153995505_85af98bf
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1920 with session sess_1759153995391_4da6e0ea
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_51b95817aa164c44 across 3 flights for session sess_1759153995256_7ff46328
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995440_999aa297 on flight 956
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995419_c3f7a123 on flight 6178
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6381
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6304 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6365 with IN_PROGRESS status for session sess_1759153995256_7ff46328
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995446_e6034db0 on flight 1787
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7424 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6304 with session sess_1759153995331_27c76f63
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7424 with session sess_1759153995446_e47fd2db
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2643
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 191 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7268
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 956
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2633 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6178
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3447 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 191 with session sess_1759153995360_bfc4cf18
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2633 with session sess_1759153995440_999aa297
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9bd3629e7c6b4c78 across 1 flights for session sess_1759153995372_5c306348
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7940
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3447 with session sess_1759153995419_c3f7a123
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6e75f135fe384e6b across 2 flights for session sess_1759153995219_c512d80b
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6365 and payment ID pay_51b95817aa164c44
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995256_7ff46328. payment ID: pay_51b95817aa164c44
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_51b95817aa164c44, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995013_7b4eec8c on flight 7890
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5530 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6366 with IN_PROGRESS status for session sess_1759153995372_5c306348
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1787
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7884 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5530 with session sess_1759153995511_1946ae4e
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6367 with IN_PROGRESS status for session sess_1759153995219_c512d80b
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7884 with session sess_1759153995446_e6034db0
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6523 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3381, 5349], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995593_d52dbd5b
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995505_85af98bf on flight 5524
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6523 with session sess_1759153995509_407d2d66
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7890
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995360_bfc4cf18 on flight 191
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6366 and payment ID pay_9bd3629e7c6b4c78
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995372_5c306348. payment ID: pay_9bd3629e7c6b4c78
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9bd3629e7c6b4c78, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e8ab99442f634742 across 3 flights for session sess_1759153995013_7b4eec8c
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995391_4da6e0ea on flight 1920
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995446_e47fd2db on flight 7424
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6367 and payment ID pay_6e75f135fe384e6b
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995219_c512d80b. payment ID: pay_6e75f135fe384e6b
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6e75f135fe384e6b, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995331_27c76f63 on flight 6304
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5524
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995446_e6034db0 on flight 7884
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6368 with IN_PROGRESS status for session sess_1759153995013_7b4eec8c
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3371 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995419_c3f7a123 on flight 3447
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7364, 7157], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995635_ba49d9b8
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0c082140eabd4e6d across 1 flights for session sess_1759153995505_85af98bf
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995511_1946ae4e on flight 5530
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995440_999aa297 on flight 2633
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[479, 2258], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995638_b3f1b863
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3371 with session sess_1759153995540_5a4d5939
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995509_407d2d66 on flight 6523
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7424
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2538 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2633
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 191
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6304
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2538 with session sess_1759153995446_e47fd2db
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1920
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6369 with IN_PROGRESS status for session sess_1759153995505_85af98bf
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2845 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2845 with session sess_1759153995391_4da6e0ea
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_2522e980680a4a9e across 2 flights for session sess_1759153995440_999aa297
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_592d479ea4ce40b8 across 3 flights for session sess_1759153995360_bfc4cf18
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3381 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7884
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_33b3d65f4b2e4d0a across 2 flights for session sess_1759153995331_27c76f63
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3447
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5b8261fc52594f74 across 2 flights for session sess_1759153995419_c3f7a123
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_fa5a954428fe4a67 across 2 flights for session sess_1759153995446_e6034db0
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3381 with session sess_1759153995593_d52dbd5b
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6368 and payment ID pay_e8ab99442f634742
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6523
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6370 with IN_PROGRESS status for session sess_1759153995331_27c76f63
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5530
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995013_7b4eec8c. payment ID: pay_e8ab99442f634742
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7809 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7555 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e8ab99442f634742, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6371 with IN_PROGRESS status for session sess_1759153995440_999aa297
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7809 with session sess_1759153995509_407d2d66
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7555 with session sess_1759153995511_1946ae4e
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6372 with IN_PROGRESS status for session sess_1759153995419_c3f7a123
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 479 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6373 with IN_PROGRESS status for session sess_1759153995446_e6034db0
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6374 with IN_PROGRESS status for session sess_1759153995360_bfc4cf18
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6369 and payment ID pay_0c082140eabd4e6d
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995505_85af98bf. payment ID: pay_0c082140eabd4e6d
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0c082140eabd4e6d, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[551, 4834], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7364 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 479 with session sess_1759153995638_b3f1b863
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995678_1b65b13b
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7364 with session sess_1759153995635_ba49d9b8
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1546, 6865, 2039], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995687_ff776ced
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6371 and payment ID pay_2522e980680a4a9e
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995440_999aa297. payment ID: pay_2522e980680a4a9e
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_2522e980680a4a9e, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6370 and payment ID pay_33b3d65f4b2e4d0a
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995331_27c76f63. payment ID: pay_33b3d65f4b2e4d0a
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_33b3d65f4b2e4d0a, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6372 and payment ID pay_5b8261fc52594f74
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995419_c3f7a123. payment ID: pay_5b8261fc52594f74
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5b8261fc52594f74, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6374 and payment ID pay_592d479ea4ce40b8
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6373 and payment ID pay_fa5a954428fe4a67
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995446_e6034db0. payment ID: pay_fa5a954428fe4a67
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995360_bfc4cf18. payment ID: pay_592d479ea4ce40b8
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995540_5a4d5939 on flight 3371
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_fa5a954428fe4a67, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_592d479ea4ce40b8, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995391_4da6e0ea on flight 2845
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5444], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995702_23ceeb23
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2043, 1546], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153995704_45b8db54
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3423, 7423], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995708_57138af6
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5084, 7619, 5414], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1632, 3830], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995709_1c7fecc7
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995709_f470ddcd
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995638_b3f1b863 on flight 479
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3371
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3754 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3754 with session sess_1759153995540_5a4d5939
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2845
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5f5ff16842284086 across 3 flights for session sess_1759153995391_4da6e0ea
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6375 with IN_PROGRESS status for session sess_1759153995391_4da6e0ea
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995446_e47fd2db on flight 2538
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 479
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2258 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2258 with session sess_1759153995638_b3f1b863
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5444 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 551 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5444 with session sess_1759153995702_23ceeb23
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1546 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995509_407d2d66 on flight 7809
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995511_1946ae4e on flight 7555
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2043 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 551 with session sess_1759153995678_1b65b13b
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3423 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2043 with session sess_1759153995704_45b8db54
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1546 with session sess_1759153995687_ff776ced
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995593_d52dbd5b on flight 3381
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3423 with session sess_1759153995708_57138af6
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6375 and payment ID pay_5f5ff16842284086
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995391_4da6e0ea. payment ID: pay_5f5ff16842284086
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5f5ff16842284086, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1632 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2538
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2057 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2057 with session sess_1759153995446_e47fd2db
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1632 with session sess_1759153995709_f470ddcd
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7809
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7718 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3381
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5349 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5349 with session sess_1759153995593_d52dbd5b
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7555
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7718 with session sess_1759153995509_407d2d66
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6749 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2411, 2522], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995776_190fac14
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6749 with session sess_1759153995511_1946ae4e
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995635_ba49d9b8 on flight 7364
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995638_b3f1b863 on flight 2258
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995687_ff776ced on flight 1546
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7364
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5084 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7157 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2258
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7157 with session sess_1759153995635_ba49d9b8
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4349b0ddd12b4703 across 2 flights for session sess_1759153995638_b3f1b863
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5084 with session sess_1759153995709_1c7fecc7
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6376 with IN_PROGRESS status for session sess_1759153995638_b3f1b863
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995708_57138af6 on flight 3423
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995678_1b65b13b on flight 551
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3423
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7423 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6376 and payment ID pay_4349b0ddd12b4703
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995638_b3f1b863. payment ID: pay_4349b0ddd12b4703
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4349b0ddd12b4703, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995446_e47fd2db on flight 2057
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7423 with session sess_1759153995708_57138af6
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[35, 5765, 1154], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995829_3e61b3bb
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995540_5a4d5939 on flight 3754
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995635_ba49d9b8 on flight 7157
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2057
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b3d3f291889b400a across 3 flights for session sess_1759153995446_e47fd2db
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995509_407d2d66 on flight 7718
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995593_d52dbd5b on flight 5349
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6377 with IN_PROGRESS status for session sess_1759153995446_e47fd2db
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1546
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6865 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3754
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6095 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6095 with session sess_1759153995540_5a4d5939
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6865 with session sess_1759153995687_ff776ced
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995708_57138af6 on flight 7423
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 551
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4834 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7157
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5349
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4834 with session sess_1759153995678_1b65b13b
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7718
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6377 and payment ID pay_b3d3f291889b400a
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995446_e47fd2db. payment ID: pay_b3d3f291889b400a
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b3d3f291889b400a, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e32bae7da08149cc across 2 flights for session sess_1759153995593_d52dbd5b
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a9c5fa9bfaa74267 across 2 flights for session sess_1759153995635_ba49d9b8
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6378 with IN_PROGRESS status for session sess_1759153995593_d52dbd5b
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e00fd67d954e49d4 across 3 flights for session sess_1759153995509_407d2d66
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6379 with IN_PROGRESS status for session sess_1759153995509_407d2d66
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995709_f470ddcd on flight 1632
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 35 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2411 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995702_23ceeb23 on flight 5444
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6380 with IN_PROGRESS status for session sess_1759153995635_ba49d9b8
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7423
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5145], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995867_4efe8ede
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1632
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3830 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_04b28827b4d24a9c across 2 flights for session sess_1759153995708_57138af6
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6381 with IN_PROGRESS status for session sess_1759153995708_57138af6
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2411 with session sess_1759153995776_190fac14
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995511_1946ae4e on flight 6749
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6378 and payment ID pay_e32bae7da08149cc
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995593_d52dbd5b. payment ID: pay_e32bae7da08149cc
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e32bae7da08149cc, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3830 with session sess_1759153995709_f470ddcd
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 35 with session sess_1759153995829_3e61b3bb
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5145 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6749
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5145 with session sess_1759153995867_4efe8ede
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5444
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6380 and payment ID pay_a9c5fa9bfaa74267
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995635_ba49d9b8. payment ID: pay_a9c5fa9bfaa74267
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a9c5fa9bfaa74267, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6f08fb04e8154f33 across 1 flights for session sess_1759153995702_23ceeb23
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995540_5a4d5939 on flight 6095
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1219, 1806], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153995886_67177fe8
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_04881dbe4c7547e0 across 3 flights for session sess_1759153995511_1946ae4e
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6379 and payment ID pay_e00fd67d954e49d4
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995509_407d2d66. payment ID: pay_e00fd67d954e49d4
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6381 and payment ID pay_04b28827b4d24a9c
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995708_57138af6. payment ID: pay_04b28827b4d24a9c
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e00fd67d954e49d4, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_04b28827b4d24a9c, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995678_1b65b13b on flight 4834
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6382 with IN_PROGRESS status for session sess_1759153995702_23ceeb23
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995704_45b8db54 on flight 2043
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6383 with IN_PROGRESS status for session sess_1759153995511_1946ae4e
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2788, 5983, 903], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995897_1a375a13
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995709_1c7fecc7 on flight 5084
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2043
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1546 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4803], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995900_a750cc5e
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1856, 7538, 1391], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153995900_1ff4e5d9
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1546 with session sess_1759153995704_45b8db54
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6095
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4834
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3ab0e57cccd44047 across 2 flights for session sess_1759153995678_1b65b13b
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_57f17db63304475e across 3 flights for session sess_1759153995540_5a4d5939
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995687_ff776ced on flight 6865
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6384 with IN_PROGRESS status for session sess_1759153995678_1b65b13b
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6385 with IN_PROGRESS status for session sess_1759153995540_5a4d5939
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4803 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6382 and payment ID pay_6f08fb04e8154f33
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4803 with session sess_1759153995900_a750cc5e
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995702_23ceeb23. payment ID: pay_6f08fb04e8154f33
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6f08fb04e8154f33, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995709_f470ddcd on flight 3830
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6383 and payment ID pay_04881dbe4c7547e0
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995511_1946ae4e. payment ID: pay_04881dbe4c7547e0
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_04881dbe4c7547e0, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995867_4efe8ede on flight 5145
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1219 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6865
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2039 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5084
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7619 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2039 with session sess_1759153995687_ff776ced
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7619 with session sess_1759153995709_1c7fecc7
2025-09-29 19:23:15 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6384 and payment ID pay_3ab0e57cccd44047
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995776_190fac14 on flight 2411
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995678_1b65b13b. payment ID: pay_3ab0e57cccd44047
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3ab0e57cccd44047, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3973, 5589], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995931_3f4c66e5
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6385 and payment ID pay_57f17db63304475e
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995540_5a4d5939. payment ID: pay_57f17db63304475e
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_57f17db63304475e, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1219 with session sess_1759153995886_67177fe8
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4204, 317, 2472], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153995935_9660fdb4
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5145
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_54aca483e082429a across 1 flights for session sess_1759153995867_4efe8ede
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2411
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3830
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2522 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_bf7d82387ff64ee2 across 2 flights for session sess_1759153995709_f470ddcd
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6588], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995942_73e11d61
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995704_45b8db54 on flight 1546
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2077], seatCount=1)]
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6386 with IN_PROGRESS status for session sess_1759153995867_4efe8ede
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153995944_70315f8c
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6387 with IN_PROGRESS status for session sess_1759153995709_f470ddcd
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1856 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2522 with session sess_1759153995776_190fac14
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2788 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6588 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6386 and payment ID pay_54aca483e082429a
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995867_4efe8ede. payment ID: pay_54aca483e082429a
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_54aca483e082429a, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2788 with session sess_1759153995897_1a375a13
2025-09-29 19:23:15 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1856 with session sess_1759153995900_1ff4e5d9
2025-09-29 19:23:15 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6588 with session sess_1759153995942_73e11d61
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6387 and payment ID pay_bf7d82387ff64ee2
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995709_f470ddcd. payment ID: pay_bf7d82387ff64ee2
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_bf7d82387ff64ee2, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1546
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_54e9fbb0f0ec4511 across 2 flights for session sess_1759153995704_45b8db54
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2077 (leg 1/1)
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2077 with session sess_1759153995944_70315f8c
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2655, 6768, 3053], seatCount=2)]
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153995965_827a5689
2025-09-29 19:23:15 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2078, 4421], seatCount=3)]
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:15 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153995969_322089ea
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995900_a750cc5e on flight 4803
2025-09-29 19:23:15 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995709_1c7fecc7 on flight 7619
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6388 with IN_PROGRESS status for session sess_1759153995704_45b8db54
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3973 (leg 1/2)
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3973 with session sess_1759153995931_3f4c66e5
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4803
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995776_190fac14 on flight 2522
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_420e97145e954ad1 across 1 flights for session sess_1759153995900_a750cc5e
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6389 with IN_PROGRESS status for session sess_1759153995900_a750cc5e
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6388 and payment ID pay_54e9fbb0f0ec4511
2025-09-29 19:23:15 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995704_45b8db54. payment ID: pay_54e9fbb0f0ec4511
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_54e9fbb0f0ec4511, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2522
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4204 (leg 1/3)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995886_67177fe8 on flight 1219
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4204 with session sess_1759153995935_9660fdb4
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6389 and payment ID pay_420e97145e954ad1
2025-09-29 19:23:15 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995900_a750cc5e. payment ID: pay_420e97145e954ad1
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:15 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_420e97145e954ad1, fli (truncated)...]
2025-09-29 19:23:15 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:15 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3023e57251794da8 across 2 flights for session sess_1759153995776_190fac14
2025-09-29 19:23:15 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995829_3e61b3bb on flight 35
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1219
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1806 (leg 2/2)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1806 with session sess_1759153995886_67177fe8
2025-09-29 19:23:15 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:15 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:15 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6390 with IN_PROGRESS status for session sess_1759153995776_190fac14
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7619
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 35
2025-09-29 19:23:15 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5414 (leg 3/3)
2025-09-29 19:23:15 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5765 (leg 2/3)
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:15 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5414 with session sess_1759153995709_1c7fecc7
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6156, 683, 3106], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995942_73e11d61 on flight 6588
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996000_0690a6f7
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1596, 1754, 1937], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996004_9a9c993f
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6390 and payment ID pay_3023e57251794da8
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995776_190fac14. payment ID: pay_3023e57251794da8
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3023e57251794da8, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2078 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6588
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5765 with session sess_1759153995829_3e61b3bb
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2078 with session sess_1759153995969_322089ea
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995897_1a375a13 on flight 2788
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_749bd88ce7da4431 across 1 flights for session sess_1759153995942_73e11d61
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995900_1ff4e5d9 on flight 1856
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6391 with IN_PROGRESS status for session sess_1759153995942_73e11d61
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5743, 2837, 20], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153996019_f11afb5c
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995687_ff776ced on flight 2039
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995944_70315f8c on flight 2077
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1856
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7538 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7538 with session sess_1759153995900_1ff4e5d9
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2788
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5983 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2655 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2039
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5983 with session sess_1759153995897_1a375a13
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6391 and payment ID pay_749bd88ce7da4431
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995942_73e11d61. payment ID: pay_749bd88ce7da4431
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995931_3f4c66e5 on flight 3973
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_749bd88ce7da4431, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2077
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2655 with session sess_1759153995965_827a5689
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6bdc7a83510a46db across 3 flights for session sess_1759153995687_ff776ced
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6392 with IN_PROGRESS status for session sess_1759153995687_ff776ced
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_95e91fdcaf634316 across 1 flights for session sess_1759153995944_70315f8c
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6156 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6156 with session sess_1759153996000_0690a6f7
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[905, 1548], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153996068_b6f19356
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1596 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995969_322089ea on flight 2078
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6393 with IN_PROGRESS status for session sess_1759153995944_70315f8c
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3973
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5589 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995886_67177fe8 on flight 1806
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5589 with session sess_1759153995931_3f4c66e5
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6392 and payment ID pay_6bdc7a83510a46db
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995687_ff776ced. payment ID: pay_6bdc7a83510a46db
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6bdc7a83510a46db, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995709_1c7fecc7 on flight 5414
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2078
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4421 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1806
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995935_9660fdb4 on flight 4204
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_34e568f3778c4802 across 2 flights for session sess_1759153995886_67177fe8
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6393 and payment ID pay_95e91fdcaf634316
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995829_3e61b3bb on flight 5765
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995944_70315f8c. payment ID: pay_95e91fdcaf634316
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_95e91fdcaf634316, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4421 with session sess_1759153995969_322089ea
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1596 with session sess_1759153996004_9a9c993f
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5414
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5743 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5468, 2389], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153996093_77f08b54
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4204
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 317 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ed6ffe5d02d5487f across 3 flights for session sess_1759153995709_1c7fecc7
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 317 with session sess_1759153995935_9660fdb4
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 905 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5743 with session sess_1759153996019_f11afb5c
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 905 with session sess_1759153996068_b6f19356
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6394 with IN_PROGRESS status for session sess_1759153995709_1c7fecc7
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4186], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153996101_317f9725
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995900_1ff4e5d9 on flight 7538
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6395 with IN_PROGRESS status for session sess_1759153995886_67177fe8
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6394 and payment ID pay_ed6ffe5d02d5487f
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995709_1c7fecc7. payment ID: pay_ed6ffe5d02d5487f
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ed6ffe5d02d5487f, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4186 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7538
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1391 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1391 with session sess_1759153995900_1ff4e5d9
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4186 with session sess_1759153996101_317f9725
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6395 and payment ID pay_34e568f3778c4802
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995886_67177fe8. payment ID: pay_34e568f3778c4802
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_34e568f3778c4802, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3460, 3230, 230], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996120_8f4ce682
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5765
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1154 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4926], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153996129_b7d46c9b
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1154 with session sess_1759153995829_3e61b3bb
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996019_f11afb5c on flight 5743
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995965_827a5689 on flight 2655
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4926 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5468 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5468 with session sess_1759153996093_77f08b54
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4926 with session sess_1759153996129_b7d46c9b
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5743
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2837 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995935_9660fdb4 on flight 317
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2837 with session sess_1759153996019_f11afb5c
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996000_0690a6f7 on flight 6156
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996101_317f9725 on flight 4186
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 317
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2472 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995897_1a375a13 on flight 5983
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2472 with session sess_1759153995935_9660fdb4
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995829_3e61b3bb on flight 1154
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995900_1ff4e5d9 on flight 1391
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6156
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995969_322089ea on flight 4421
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 683 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996068_b6f19356 on flight 905
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3460 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 683 with session sess_1759153996000_0690a6f7
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995931_3f4c66e5 on flight 5589
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996004_9a9c993f on flight 1596
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5983
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 903 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3460 with session sess_1759153996120_8f4ce682
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4186
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 903 with session sess_1759153995897_1a375a13
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2655
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6768 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6768 with session sess_1759153995965_827a5689
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1154
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 905
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_712effe0fc0c45a5 across 3 flights for session sess_1759153995829_3e61b3bb
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1548 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e2291c0361044b19 across 1 flights for session sess_1759153996101_317f9725
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1548 with session sess_1759153996068_b6f19356
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1596
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1754 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1754 with session sess_1759153996004_9a9c993f
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5589
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6396 with IN_PROGRESS status for session sess_1759153995829_3e61b3bb
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6397 with IN_PROGRESS status for session sess_1759153996101_317f9725
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4421
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1391
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153995935_9660fdb4 on flight 2472
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8ebeef93ae0c46cb across 2 flights for session sess_1759153995931_3f4c66e5
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_541eb030c12b42e1 across 2 flights for session sess_1759153995969_322089ea
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3d11f3ab159e40e1 across 3 flights for session sess_1759153995900_1ff4e5d9
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6398 with IN_PROGRESS status for session sess_1759153995931_3f4c66e5
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6399 with IN_PROGRESS status for session sess_1759153995900_1ff4e5d9
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2472
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6396 and payment ID pay_712effe0fc0c45a5
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995829_3e61b3bb. payment ID: pay_712effe0fc0c45a5
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f8efe0bd83bb413c across 3 flights for session sess_1759153995935_9660fdb4
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_712effe0fc0c45a5, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6401 with IN_PROGRESS status for session sess_1759153995935_9660fdb4
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6400 with IN_PROGRESS status for session sess_1759153995969_322089ea
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6397 and payment ID pay_e2291c0361044b19
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996101_317f9725. payment ID: pay_e2291c0361044b19
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e2291c0361044b19, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6398 and payment ID pay_8ebeef93ae0c46cb
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995931_3f4c66e5. payment ID: pay_8ebeef93ae0c46cb
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996068_b6f19356 on flight 1548
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8ebeef93ae0c46cb, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6401 and payment ID pay_f8efe0bd83bb413c
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995935_9660fdb4. payment ID: pay_f8efe0bd83bb413c
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f8efe0bd83bb413c, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2135, 2762], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153996214_8104824c
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6400 and payment ID pay_541eb030c12b42e1
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995969_322089ea. payment ID: pay_541eb030c12b42e1
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_541eb030c12b42e1, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6399 and payment ID pay_3d11f3ab159e40e1
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995900_1ff4e5d9. payment ID: pay_3d11f3ab159e40e1
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1548
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3d11f3ab159e40e1, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4255, 169], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153996219_f9c1351f
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5032, 480], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153996221_eee4d01f
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6870, 1580, 3701], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996221_4137892c
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_2aa3c0020e1d400c across 2 flights for session sess_1759153996068_b6f19356
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996129_b7d46c9b on flight 4926
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6402 with IN_PROGRESS status for session sess_1759153996068_b6f19356
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6341, 5951, 7064], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996228_368b8bc1
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[88, 3351], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153996229_cb53ed6a
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4255 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4255 with session sess_1759153996219_f9c1351f
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4926
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996093_77f08b54 on flight 5468
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7ce8f077d654464b across 1 flights for session sess_1759153996129_b7d46c9b
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153995897_1a375a13 on flight 903
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996019_f11afb5c on flight 2837
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5032 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6403 with IN_PROGRESS status for session sess_1759153996129_b7d46c9b
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5032 with session sess_1759153996221_eee4d01f
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996000_0690a6f7 on flight 683
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2135 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 903
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996004_9a9c993f on flight 1754
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2135 with session sess_1759153996214_8104824c
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b80a6c3376d04efb across 3 flights for session sess_1759153995897_1a375a13
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2837
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6403 and payment ID pay_7ce8f077d654464b
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 20 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996129_b7d46c9b. payment ID: pay_7ce8f077d654464b
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6402 and payment ID pay_2aa3c0020e1d400c
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996068_b6f19356. payment ID: pay_2aa3c0020e1d400c
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7ce8f077d654464b, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_2aa3c0020e1d400c, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5468
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 683
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3106 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2389 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6404 with IN_PROGRESS status for session sess_1759153995897_1a375a13
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2389 with session sess_1759153996093_77f08b54
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 20 with session sess_1759153996019_f11afb5c
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3106 with session sess_1759153996000_0690a6f7
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 88 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6341 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1316, 1877], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5979, 4218, 1656], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153996271_f887da68
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996271_9cba80ed
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1754
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6341 with session sess_1759153996228_368b8bc1
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1937 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6404 and payment ID pay_b80a6c3376d04efb
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995897_1a375a13. payment ID: pay_b80a6c3376d04efb
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 88 with session sess_1759153996229_cb53ed6a
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1937 with session sess_1759153996004_9a9c993f
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b80a6c3376d04efb, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6870 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996120_8f4ce682 on flight 3460
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6870 with session sess_1759153996221_4137892c
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995965_827a5689 on flight 6768
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1003, 3745], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153996294_4bf5bdf7
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996214_8104824c on flight 2135
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996019_f11afb5c on flight 20
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996219_f9c1351f on flight 4255
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3460
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3230 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3230 with session sess_1759153996120_8f4ce682
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6768
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3053 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2135
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2762 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 20
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4255
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 169 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3053 with session sess_1759153995965_827a5689
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 169 with session sess_1759153996219_f9c1351f
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1316 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2762 with session sess_1759153996214_8104824c
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1316 with session sess_1759153996271_f887da68
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5979 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_825076938a324109 across 3 flights for session sess_1759153996019_f11afb5c
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5979 with session sess_1759153996271_9cba80ed
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6405 with IN_PROGRESS status for session sess_1759153996019_f11afb5c
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996093_77f08b54 on flight 2389
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2389
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1003 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_641496a1374d4a42 across 2 flights for session sess_1759153996093_77f08b54
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1003 with session sess_1759153996294_4bf5bdf7
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6406 with IN_PROGRESS status for session sess_1759153996093_77f08b54
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996221_eee4d01f on flight 5032
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996228_368b8bc1 on flight 6341
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996120_8f4ce682 on flight 3230
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996004_9a9c993f on flight 1937
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6405 and payment ID pay_825076938a324109
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996000_0690a6f7 on flight 3106
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996019_f11afb5c. payment ID: pay_825076938a324109
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_825076938a324109, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5032
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 480 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996271_f887da68 on flight 1316
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1937
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6341
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5951 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996221_4137892c on flight 6870
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_16b38ca5b765431c across 3 flights for session sess_1759153996004_9a9c993f
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 480 with session sess_1759153996221_eee4d01f
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3230
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 230 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6978, 1502], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153996357_d97be90a
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6406 and payment ID pay_641496a1374d4a42
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996093_77f08b54. payment ID: pay_641496a1374d4a42
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6407 with IN_PROGRESS status for session sess_1759153996004_9a9c993f
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 230 with session sess_1759153996120_8f4ce682
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_641496a1374d4a42, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3106
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5951 with session sess_1759153996228_368b8bc1
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996214_8104824c on flight 2762
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b31c8fdfc66b400d across 3 flights for session sess_1759153996000_0690a6f7
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6870
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1580 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6408 with IN_PROGRESS status for session sess_1759153996000_0690a6f7
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6407 and payment ID pay_16b38ca5b765431c
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996004_9a9c993f. payment ID: pay_16b38ca5b765431c
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_16b38ca5b765431c, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1908, 5517, 3549], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996372_cac70065
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2762
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1580 with session sess_1759153996221_4137892c
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996229_cb53ed6a on flight 88
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c6fcd2f6a77b4de9 across 2 flights for session sess_1759153996214_8104824c
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6409 with IN_PROGRESS status for session sess_1759153996214_8104824c
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6408 and payment ID pay_b31c8fdfc66b400d
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996000_0690a6f7. payment ID: pay_b31c8fdfc66b400d
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b31c8fdfc66b400d, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5683, 7694, 64], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996381_d00a59e1
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 88
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3351 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3351 with session sess_1759153996229_cb53ed6a
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6409 and payment ID pay_c6fcd2f6a77b4de9
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996214_8104824c. payment ID: pay_c6fcd2f6a77b4de9
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c6fcd2f6a77b4de9, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2169, 633, 7321], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996394_7cb0c66f
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5957], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153996400_0a2b07d4
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996294_4bf5bdf7 on flight 1003
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996219_f9c1351f on flight 169
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996221_eee4d01f on flight 480
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1316
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1877 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153995965_827a5689 on flight 3053
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1877 with session sess_1759153996271_f887da68
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6978 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1003
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5957 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3745 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5957 with session sess_1759153996400_0a2b07d4
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996120_8f4ce682 on flight 230
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 169
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6978 with session sess_1759153996357_d97be90a
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3745 with session sess_1759153996294_4bf5bdf7
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996271_9cba80ed on flight 5979
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7f6a8cb540834485 across 2 flights for session sess_1759153996219_f9c1351f
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 480
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6410 with IN_PROGRESS status for session sess_1759153996219_f9c1351f
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a66ae435f39e4662 across 2 flights for session sess_1759153996221_eee4d01f
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3053
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 230
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5979
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6411 with IN_PROGRESS status for session sess_1759153996221_eee4d01f
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_cd77a34a2a6c429c across 3 flights for session sess_1759153996120_8f4ce682
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4218 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b080b51ab83646a9 across 3 flights for session sess_1759153995965_827a5689
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996221_4137892c on flight 1580
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996228_368b8bc1 on flight 5951
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996229_cb53ed6a on flight 3351
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4218 with session sess_1759153996271_9cba80ed
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6412 with IN_PROGRESS status for session sess_1759153996120_8f4ce682
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1908 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6413 with IN_PROGRESS status for session sess_1759153995965_827a5689
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5683 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996294_4bf5bdf7 on flight 3745
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1908 with session sess_1759153996372_cac70065
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6410 and payment ID pay_7f6a8cb540834485
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996219_f9c1351f. payment ID: pay_7f6a8cb540834485
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7f6a8cb540834485, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5683 with session sess_1759153996381_d00a59e1
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6411 and payment ID pay_a66ae435f39e4662
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1580
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996221_eee4d01f. payment ID: pay_a66ae435f39e4662
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3701 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a66ae435f39e4662, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2169 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3701 with session sess_1759153996221_4137892c
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996271_f887da68 on flight 1877
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5951
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6413 and payment ID pay_b080b51ab83646a9
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7064 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153995965_827a5689. payment ID: pay_b080b51ab83646a9
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3351
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b080b51ab83646a9, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2169 with session sess_1759153996394_7cb0c66f
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1269, 6294, 2254], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153996485_ca3c3cbe
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4ffe8d1b3b0b4040 across 2 flights for session sess_1759153996229_cb53ed6a
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7064 with session sess_1759153996228_368b8bc1
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3745
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6412 and payment ID pay_cd77a34a2a6c429c
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996120_8f4ce682. payment ID: pay_cd77a34a2a6c429c
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_cd77a34a2a6c429c, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1485, 1459, 3553], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996400_0a2b07d4 on flight 5957
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153996493_8533d0a9
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_07c5c9f86cb14676 across 2 flights for session sess_1759153996294_4bf5bdf7
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1240, 6364, 7007], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996497_903dd451
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6414 with IN_PROGRESS status for session sess_1759153996229_cb53ed6a
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996357_d97be90a on flight 6978
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6415 with IN_PROGRESS status for session sess_1759153996294_4bf5bdf7
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1877
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5739], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153996504_8e893f33
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996381_d00a59e1 on flight 5683
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6414 and payment ID pay_4ffe8d1b3b0b4040
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996271_9cba80ed on flight 4218
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996229_cb53ed6a. payment ID: pay_4ffe8d1b3b0b4040
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4ffe8d1b3b0b4040, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996372_cac70065 on flight 1908
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_54fc860b9b9c4729 across 2 flights for session sess_1759153996271_f887da68
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5957
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6416 with IN_PROGRESS status for session sess_1759153996271_f887da68
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_bab8eae100f84325 across 1 flights for session sess_1759153996400_0a2b07d4
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6415 and payment ID pay_07c5c9f86cb14676
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996294_4bf5bdf7. payment ID: pay_07c5c9f86cb14676
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_07c5c9f86cb14676, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5683
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6978
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1502 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7694 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5739 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996221_4137892c on flight 3701
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7694 with session sess_1759153996381_d00a59e1
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1502 with session sess_1759153996357_d97be90a
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5739 with session sess_1759153996504_8e893f33
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5466, 7895, 1488], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153996521_aae81ba8
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6417 with IN_PROGRESS status for session sess_1759153996400_0a2b07d4
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6416 and payment ID pay_54fc860b9b9c4729
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996271_f887da68. payment ID: pay_54fc860b9b9c4729
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_54fc860b9b9c4729, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4779, 6692], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153996528_f5a15176
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996228_368b8bc1 on flight 7064
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4218
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1656 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1656 with session sess_1759153996271_9cba80ed
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2241], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153996540_da0c9081
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3701
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7064
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996504_8e893f33 on flight 5739
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6e4ab6764335448d across 3 flights for session sess_1759153996221_4137892c
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1908
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5517 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6417 and payment ID pay_bab8eae100f84325
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996394_7cb0c66f on flight 2169
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996400_0a2b07d4. payment ID: pay_bab8eae100f84325
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1269 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_bab8eae100f84325, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5517 with session sess_1759153996372_cac70065
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_765fa5e61ff645ff across 3 flights for session sess_1759153996228_368b8bc1
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6418 with IN_PROGRESS status for session sess_1759153996221_4137892c
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6419 with IN_PROGRESS status for session sess_1759153996228_368b8bc1
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1269 with session sess_1759153996485_ca3c3cbe
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1485 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6589, 5757, 879], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996558_564c3f68
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1240 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2169
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 633 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1485 with session sess_1759153996493_8533d0a9
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5739
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6418 and payment ID pay_6e4ab6764335448d
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996221_4137892c. payment ID: pay_6e4ab6764335448d
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6e4ab6764335448d, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2241 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b9bf58920fbe413b across 1 flights for session sess_1759153996504_8e893f33
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6419 and payment ID pay_765fa5e61ff645ff
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996228_368b8bc1. payment ID: pay_765fa5e61ff645ff
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_765fa5e61ff645ff, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1240 with session sess_1759153996497_903dd451
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2241 with session sess_1759153996540_da0c9081
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 633 with session sess_1759153996394_7cb0c66f
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6420 with IN_PROGRESS status for session sess_1759153996504_8e893f33
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4779 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4779 with session sess_1759153996528_f5a15176
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6420 and payment ID pay_b9bf58920fbe413b
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996504_8e893f33. payment ID: pay_b9bf58920fbe413b
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b9bf58920fbe413b, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7833, 6412], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153996575_7e1e80b7
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5466 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3800, 2136], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153996577_703901ef
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996271_9cba80ed on flight 1656
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5466 with session sess_1759153996521_aae81ba8
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1656
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[717, 6694], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153996587_3b95b1b7
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9dce585a85cd4cca across 3 flights for session sess_1759153996271_9cba80ed
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6421 with IN_PROGRESS status for session sess_1759153996271_9cba80ed
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996357_d97be90a on flight 1502
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996381_d00a59e1 on flight 7694
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996372_cac70065 on flight 5517
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996493_8533d0a9 on flight 1485
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6421 and payment ID pay_9dce585a85cd4cca
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996394_7cb0c66f on flight 633
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996271_9cba80ed. payment ID: pay_9dce585a85cd4cca
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9dce585a85cd4cca, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996528_f5a15176 on flight 4779
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7694
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5517
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 64 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3549 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996485_ca3c3cbe on flight 1269
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1502
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4234, 1788], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153996620_e1232b18
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 64 with session sess_1759153996381_d00a59e1
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_59c39814be0f4514 across 2 flights for session sess_1759153996357_d97be90a
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3549 with session sess_1759153996372_cac70065
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1485
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1459 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6422 with IN_PROGRESS status for session sess_1759153996357_d97be90a
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 717 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1459 with session sess_1759153996493_8533d0a9
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3800 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 717 with session sess_1759153996587_3b95b1b7
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 633
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4779
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7321 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6692 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996521_aae81ba8 on flight 5466
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996540_da0c9081 on flight 2241
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3800 with session sess_1759153996577_703901ef
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6692 with session sess_1759153996528_f5a15176
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6589 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996497_903dd451 on flight 1240
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7321 with session sess_1759153996394_7cb0c66f
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1269
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6294 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7833 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6589 with session sess_1759153996558_564c3f68
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6294 with session sess_1759153996485_ca3c3cbe
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7833 with session sess_1759153996575_7e1e80b7
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6422 and payment ID pay_59c39814be0f4514
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996357_d97be90a. payment ID: pay_59c39814be0f4514
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_59c39814be0f4514, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5466
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7895 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1240
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6364 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7895 with session sess_1759153996521_aae81ba8
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3812, 6885, 212], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996693_8243a95e
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4234 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2241
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4234 with session sess_1759153996620_e1232b18
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6364 with session sess_1759153996497_903dd451
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_be615acf7021473a across 1 flights for session sess_1759153996540_da0c9081
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6423 with IN_PROGRESS status for session sess_1759153996540_da0c9081
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996381_d00a59e1 on flight 64
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6423 and payment ID pay_be615acf7021473a
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996540_da0c9081. payment ID: pay_be615acf7021473a
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996493_8533d0a9 on flight 1459
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_be615acf7021473a, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996485_ca3c3cbe on flight 6294
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6294
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2254 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7024, 315, 1242], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996728_c0c68264
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 64
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996575_7e1e80b7 on flight 7833
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996558_564c3f68 on flight 6589
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996528_f5a15176 on flight 6692
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996372_cac70065 on flight 3549
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3549
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2254 with session sess_1759153996485_ca3c3cbe
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_25300927f9784d28 across 3 flights for session sess_1759153996372_cac70065
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6589
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5757 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7833
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6424 with IN_PROGRESS status for session sess_1759153996372_cac70065
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6412 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8d85072533c54d33 across 3 flights for session sess_1759153996381_d00a59e1
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6412 with session sess_1759153996575_7e1e80b7
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5757 with session sess_1759153996558_564c3f68
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1459
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3553 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3553 with session sess_1759153996493_8533d0a9
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6425 with IN_PROGRESS status for session sess_1759153996381_d00a59e1
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996521_aae81ba8 on flight 7895
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996620_e1232b18 on flight 4234
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996394_7cb0c66f on flight 7321
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6424 and payment ID pay_25300927f9784d28
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996372_cac70065. payment ID: pay_25300927f9784d28
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_25300927f9784d28, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3812 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996577_703901ef on flight 3800
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6692
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996587_3b95b1b7 on flight 717
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_aabab87ccf4e4aa0 across 2 flights for session sess_1759153996528_f5a15176
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7321
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4234
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1788 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3812 with session sess_1759153996693_8243a95e
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8eca7f90cf884ac7 across 3 flights for session sess_1759153996394_7cb0c66f
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6426 with IN_PROGRESS status for session sess_1759153996528_f5a15176
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1788 with session sess_1759153996620_e1232b18
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1046, 7156], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153996768_ea1f143a
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6427 with IN_PROGRESS status for session sess_1759153996394_7cb0c66f
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3800
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2136 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2136 with session sess_1759153996577_703901ef
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 717
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7895
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6425 and payment ID pay_8d85072533c54d33
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6694 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1488 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996381_d00a59e1. payment ID: pay_8d85072533c54d33
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8d85072533c54d33, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996558_564c3f68 on flight 5757
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6694 with session sess_1759153996587_3b95b1b7
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1488 with session sess_1759153996521_aae81ba8
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6426 and payment ID pay_aabab87ccf4e4aa0
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996528_f5a15176. payment ID: pay_aabab87ccf4e4aa0
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_aabab87ccf4e4aa0, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996497_903dd451 on flight 6364
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7024 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4937, 3035, 4909], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153996788_ca07e68c
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996485_ca3c3cbe on flight 2254
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7024 with session sess_1759153996728_c0c68264
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6427 and payment ID pay_8eca7f90cf884ac7
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996394_7cb0c66f. payment ID: pay_8eca7f90cf884ac7
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8eca7f90cf884ac7, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3729], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153996793_e983b274
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996493_8533d0a9 on flight 3553
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6364
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7007 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5757
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 879 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 879 with session sess_1759153996558_564c3f68
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7007 with session sess_1759153996497_903dd451
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996620_e1232b18 on flight 1788
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1046 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4043], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153996804_f4793d18
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1046 with session sess_1759153996768_ea1f143a
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2254
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_921fc51e27d84e80 across 3 flights for session sess_1759153996485_ca3c3cbe
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996577_703901ef on flight 2136
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3729 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6428 with IN_PROGRESS status for session sess_1759153996485_ca3c3cbe
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3553
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4043 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1788
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3729 with session sess_1759153996793_e983b274
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4043 with session sess_1759153996804_f4793d18
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_990428a6515143de across 3 flights for session sess_1759153996493_8533d0a9
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0e59c235258c43b4 across 2 flights for session sess_1759153996620_e1232b18
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6428 and payment ID pay_921fc51e27d84e80
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996485_ca3c3cbe. payment ID: pay_921fc51e27d84e80
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_921fc51e27d84e80, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6429 with IN_PROGRESS status for session sess_1759153996493_8533d0a9
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6430 with IN_PROGRESS status for session sess_1759153996620_e1232b18
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996575_7e1e80b7 on flight 6412
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4937 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2136
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4937 with session sess_1759153996788_ca07e68c
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3d0c354ea55c474d across 2 flights for session sess_1759153996577_703901ef
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6431 with IN_PROGRESS status for session sess_1759153996577_703901ef
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3650], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153996831_8fd2d4d7
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6429 and payment ID pay_990428a6515143de
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996493_8533d0a9. payment ID: pay_990428a6515143de
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_990428a6515143de, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6412
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6431 and payment ID pay_3d0c354ea55c474d
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996693_8243a95e on flight 3812
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996577_703901ef. payment ID: pay_3d0c354ea55c474d
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7e6f504644574d3f across 2 flights for session sess_1759153996575_7e1e80b7
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3d0c354ea55c474d, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996521_aae81ba8 on flight 1488
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6432 with IN_PROGRESS status for session sess_1759153996575_7e1e80b7
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6430 and payment ID pay_0e59c235258c43b4
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996620_e1232b18. payment ID: pay_0e59c235258c43b4
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0e59c235258c43b4, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1466, 2413, 2328], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153996845_d9f26c5b
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6432 and payment ID pay_7e6f504644574d3f
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996575_7e1e80b7. payment ID: pay_7e6f504644574d3f
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7e6f504644574d3f, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6048], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153996848_14b444ae
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1488
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3812
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6885 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6885 with session sess_1759153996693_8243a95e
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_14683a898bb64fe3 across 3 flights for session sess_1759153996521_aae81ba8
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996558_564c3f68 on flight 879
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7370, 475], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153996857_d4504c27
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6048 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[987], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153996860_f80abe11
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6048 with session sess_1759153996848_14b444ae
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6433 with IN_PROGRESS status for session sess_1759153996521_aae81ba8
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3650 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3650 with session sess_1759153996831_8fd2d4d7
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996768_ea1f143a on flight 1046
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996804_f4793d18 on flight 4043
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 879
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6433 and payment ID pay_14683a898bb64fe3
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996521_aae81ba8. payment ID: pay_14683a898bb64fe3
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_14683a898bb64fe3, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 987 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4043
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7370 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1046
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7156 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7370 with session sess_1759153996857_d4504c27
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_fe3f74a28957489e across 3 flights for session sess_1759153996558_564c3f68
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7156 with session sess_1759153996768_ea1f143a
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_01ad002f6e5e485e across 1 flights for session sess_1759153996804_f4793d18
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 987 with session sess_1759153996860_f80abe11
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3791], seatCount=2)]
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153996889_fb6b64ba
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996693_8243a95e on flight 6885
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996728_c0c68264 on flight 7024
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6434 with IN_PROGRESS status for session sess_1759153996804_f4793d18
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6435 with IN_PROGRESS status for session sess_1759153996558_564c3f68
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996793_e983b274 on flight 3729
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996788_ca07e68c on flight 4937
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996497_903dd451 on flight 7007
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996587_3b95b1b7 on flight 6694
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996857_d4504c27 on flight 7370
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3791 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6885
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 212 (leg 3/3)
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3791 with session sess_1759153996889_fb6b64ba
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 212 with session sess_1759153996693_8243a95e
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7024
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6434 and payment ID pay_01ad002f6e5e485e
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 315 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996804_f4793d18. payment ID: pay_01ad002f6e5e485e
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_01ad002f6e5e485e, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1466 (leg 1/3)
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 315 with session sess_1759153996728_c0c68264
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996831_8fd2d4d7 on flight 3650
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6435 and payment ID pay_fe3f74a28957489e
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996558_564c3f68. payment ID: pay_fe3f74a28957489e
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_fe3f74a28957489e, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996848_14b444ae on flight 6048
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996768_ea1f143a on flight 7156
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1466 with session sess_1759153996845_d9f26c5b
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1440], seatCount=3)]
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153996937_753fc495
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4937
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3035 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7007
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3729
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4252, 5469], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153996943_3fab8439
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7370
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 475 (leg 2/2)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_df1a74481cdc4b24 across 3 flights for session sess_1759153996497_903dd451
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ea30ea9b0fe04627 across 1 flights for session sess_1759153996793_e983b274
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3035 with session sess_1759153996788_ca07e68c
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6694
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ea95d8dda98240cf across 2 flights for session sess_1759153996587_3b95b1b7
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 475 with session sess_1759153996857_d4504c27
2025-09-29 19:23:16 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3650
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996693_8243a95e on flight 212
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6436 with IN_PROGRESS status for session sess_1759153996793_e983b274
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_09f25b23463c47ef across 1 flights for session sess_1759153996831_8fd2d4d7
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6437 with IN_PROGRESS status for session sess_1759153996497_903dd451
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1440 (leg 1/1)
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996845_d9f26c5b on flight 1466
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996860_f80abe11 on flight 987
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7156
2025-09-29 19:23:16 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1440 with session sess_1759153996937_753fc495
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6048
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6438 with IN_PROGRESS status for session sess_1759153996831_8fd2d4d7
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6439 with IN_PROGRESS status for session sess_1759153996587_3b95b1b7
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_dba7ac9e7d294b7a across 2 flights for session sess_1759153996768_ea1f143a
2025-09-29 19:23:16 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6436 and payment ID pay_ea30ea9b0fe04627
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996793_e983b274. payment ID: pay_ea30ea9b0fe04627
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ea30ea9b0fe04627, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_495f7502db924111 across 1 flights for session sess_1759153996848_14b444ae
2025-09-29 19:23:16 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 212
2025-09-29 19:23:16 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6440 with IN_PROGRESS status for session sess_1759153996768_ea1f143a
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 987
2025-09-29 19:23:16 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_1b3f8a29855f49c3 across 3 flights for session sess_1759153996693_8243a95e
2025-09-29 19:23:16 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6441 with IN_PROGRESS status for session sess_1759153996848_14b444ae
2025-09-29 19:23:16 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4252 (leg 1/2)
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6437 and payment ID pay_df1a74481cdc4b24
2025-09-29 19:23:16 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996728_c0c68264 on flight 315
2025-09-29 19:23:16 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996497_903dd451. payment ID: pay_df1a74481cdc4b24
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_df1a74481cdc4b24, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4252 with session sess_1759153996943_3fab8439
2025-09-29 19:23:16 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6438 and payment ID pay_09f25b23463c47ef
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1466
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2413 (leg 2/3)
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:16 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996831_8fd2d4d7. payment ID: pay_09f25b23463c47ef
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_09f25b23463c47ef, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6213], seatCount=1)]
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_224c39a3abe44174 across 1 flights for session sess_1759153996860_f80abe11
2025-09-29 19:23:16 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:16 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153996991_bcf4e9e1
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996889_fb6b64ba on flight 3791
2025-09-29 19:23:16 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2413 with session sess_1759153996845_d9f26c5b
2025-09-29 19:23:16 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:16 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:16 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6439 and payment ID pay_ea95d8dda98240cf
2025-09-29 19:23:16 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996587_3b95b1b7. payment ID: pay_ea95d8dda98240cf
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ea95d8dda98240cf, fli (truncated)...]
2025-09-29 19:23:16 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6443 with IN_PROGRESS status for session sess_1759153996860_f80abe11
2025-09-29 19:23:16 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6442 with IN_PROGRESS status for session sess_1759153996693_8243a95e
2025-09-29 19:23:16 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7611, 5469], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6440 and payment ID pay_dba7ac9e7d294b7a
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996768_ea1f143a. payment ID: pay_dba7ac9e7d294b7a
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153997002_a8f0d241
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_dba7ac9e7d294b7a, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6441 and payment ID pay_495f7502db924111
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996848_14b444ae. payment ID: pay_495f7502db924111
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_495f7502db924111, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1227, 4847, 5800], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153997004_629dc923
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996788_ca07e68c on flight 3035
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 315
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1242 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996857_d4504c27 on flight 475
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6213 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3791
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1242 with session sess_1759153996728_c0c68264
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2457, 2469], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997012_a5bdd421
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6443 and payment ID pay_224c39a3abe44174
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996860_f80abe11. payment ID: pay_224c39a3abe44174
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153996937_753fc495 on flight 1440
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_224c39a3abe44174, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 475
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6294], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[536, 4736, 1054], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153997016_b4358b4e
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997017_df5609bf
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d325308680914026 across 1 flights for session sess_1759153996889_fb6b64ba
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6213 with session sess_1759153996991_bcf4e9e1
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a60d1c077ee74d69 across 2 flights for session sess_1759153996857_d4504c27
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6444 with IN_PROGRESS status for session sess_1759153996889_fb6b64ba
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3035
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4909 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6442 and payment ID pay_1b3f8a29855f49c3
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996693_8243a95e. payment ID: pay_1b3f8a29855f49c3
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_1b3f8a29855f49c3, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6445 with IN_PROGRESS status for session sess_1759153996857_d4504c27
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[110], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153997027_9440e2aa
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4909 with session sess_1759153996788_ca07e68c
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996943_3fab8439 on flight 4252
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6294 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1440
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6294 with session sess_1759153997016_b4358b4e
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7022, 7359, 5466], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997036_bdffe883
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0e59e5a34d764e4b across 1 flights for session sess_1759153996937_753fc495
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6445 and payment ID pay_a60d1c077ee74d69
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996857_d4504c27. payment ID: pay_a60d1c077ee74d69
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a60d1c077ee74d69, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2457 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6444 and payment ID pay_d325308680914026
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996889_fb6b64ba. payment ID: pay_d325308680914026
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d325308680914026, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7611 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 110 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6446 with IN_PROGRESS status for session sess_1759153996937_753fc495
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2457 with session sess_1759153997012_a5bdd421
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4252
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5469 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996728_c0c68264 on flight 1242
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5469 with session sess_1759153996943_3fab8439
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7611 with session sess_1759153997002_a8f0d241
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 110 with session sess_1759153997027_9440e2aa
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1468], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153997058_0ecd31fa
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4965, 4378], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153997058_d466fc03
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6446 and payment ID pay_0e59e5a34d764e4b
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996937_753fc495. payment ID: pay_0e59e5a34d764e4b
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0e59e5a34d764e4b, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1242
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9b042e890ba64aa2 across 3 flights for session sess_1759153996728_c0c68264
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996845_d9f26c5b on flight 2413
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1227 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7206, 4879], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997075_cc2abdd1
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1227 with session sess_1759153997004_629dc923
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6447 with IN_PROGRESS status for session sess_1759153996728_c0c68264
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997002_a8f0d241 on flight 7611
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2413
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2328 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2328 with session sess_1759153996845_d9f26c5b
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 536 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153996788_ca07e68c on flight 4909
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7022 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7611
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 536 with session sess_1759153997017_df5609bf
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5469 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1468 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7022 with session sess_1759153997036_bdffe883
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1468 with session sess_1759153997058_0ecd31fa
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5469 with session sess_1759153997002_a8f0d241
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997012_a5bdd421 on flight 2457
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6447 and payment ID pay_9b042e890ba64aa2
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996728_c0c68264. payment ID: pay_9b042e890ba64aa2
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9b042e890ba64aa2, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996991_bcf4e9e1 on flight 6213
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2457
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2469 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2469 with session sess_1759153997012_a5bdd421
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4965 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997004_629dc923 on flight 1227
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4909
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1225, 4118, 1392], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153997109_025e1ebd
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a89d422875544854 across 3 flights for session sess_1759153996788_ca07e68c
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4965 with session sess_1759153997058_d466fc03
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996845_d9f26c5b on flight 2328
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1227
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4847 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6213
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6448 with IN_PROGRESS status for session sess_1759153996788_ca07e68c
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4847 with session sess_1759153997004_629dc923
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c4dc6aa43bd04bb0 across 1 flights for session sess_1759153996991_bcf4e9e1
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6449 with IN_PROGRESS status for session sess_1759153996991_bcf4e9e1
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997016_b4358b4e on flight 6294
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6448 and payment ID pay_a89d422875544854
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996788_ca07e68c. payment ID: pay_a89d422875544854
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a89d422875544854, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6449 and payment ID pay_c4dc6aa43bd04bb0
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996991_bcf4e9e1. payment ID: pay_c4dc6aa43bd04bb0
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c4dc6aa43bd04bb0, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2328
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6294
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_16707bc12d4d479d across 1 flights for session sess_1759153997016_b4358b4e
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6450 with IN_PROGRESS status for session sess_1759153997016_b4358b4e
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7206 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7767, 1149], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2495], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153997142_af8e460e
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153997142_7f4f1207
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7206 with session sess_1759153997075_cc2abdd1
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_de81646408754401 across 3 flights for session sess_1759153996845_d9f26c5b
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997058_d466fc03 on flight 4965
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6450 and payment ID pay_16707bc12d4d479d
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997016_b4358b4e. payment ID: pay_16707bc12d4d479d
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153996943_3fab8439 on flight 5469
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_16707bc12d4d479d, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6451 with IN_PROGRESS status for session sess_1759153996845_d9f26c5b
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1225 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997027_9440e2aa on flight 110
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997017_df5609bf on flight 536
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1225 with session sess_1759153997109_025e1ebd
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2495 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997036_bdffe883 on flight 7022
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997058_0ecd31fa on flight 1468
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2495 with session sess_1759153997142_7f4f1207
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7424, 6362, 5346], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997171_0d053331
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 536
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4736 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 110
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4736 with session sess_1759153997017_df5609bf
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997002_a8f0d241 on flight 5469
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997004_629dc923 on flight 4847
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7767 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a0a989ad65564e05 across 1 flights for session sess_1759153997027_9440e2aa
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7767 with session sess_1759153997142_af8e460e
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997012_a5bdd421 on flight 2469
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6452 with IN_PROGRESS status for session sess_1759153997027_9440e2aa
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5469
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e82071339e6f41d4 across 2 flights for session sess_1759153996943_3fab8439
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4965
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4378 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4378 with session sess_1759153997058_d466fc03
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6452 and payment ID pay_a0a989ad65564e05
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997027_9440e2aa. payment ID: pay_a0a989ad65564e05
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a0a989ad65564e05, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2469
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7022
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7359 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6453 with IN_PROGRESS status for session sess_1759153996943_3fab8439
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4847
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5469
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5800 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1468
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5800 with session sess_1759153997004_629dc923
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997075_cc2abdd1 on flight 7206
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6451 and payment ID pay_de81646408754401
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996845_d9f26c5b. payment ID: pay_de81646408754401
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_de81646408754401, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[904], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153997198_2f97a0e4
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_260961fd78a14cb0 across 1 flights for session sess_1759153997058_0ecd31fa
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8e413aab87314aa9 across 2 flights for session sess_1759153997012_a5bdd421
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7359 with session sess_1759153997036_bdffe883
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b10ea1383e344305 across 2 flights for session sess_1759153997002_a8f0d241
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6454 with IN_PROGRESS status for session sess_1759153997058_0ecd31fa
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6453 and payment ID pay_e82071339e6f41d4
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153996943_3fab8439. payment ID: pay_e82071339e6f41d4
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e82071339e6f41d4, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6455 with IN_PROGRESS status for session sess_1759153997012_a5bdd421
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 904 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997017_df5609bf on flight 4736
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 904 with session sess_1759153997198_2f97a0e4
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[788, 1840, 6569], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997210_41f994fd
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6456 with IN_PROGRESS status for session sess_1759153997002_a8f0d241
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7206
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4879 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6454 and payment ID pay_260961fd78a14cb0
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997058_0ecd31fa. payment ID: pay_260961fd78a14cb0
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_260961fd78a14cb0, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7424 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4879 with session sess_1759153997075_cc2abdd1
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6455 and payment ID pay_8e413aab87314aa9
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997109_025e1ebd on flight 1225
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997012_a5bdd421. payment ID: pay_8e413aab87314aa9
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4455], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8e413aab87314aa9, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153997221_e080f93c
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997058_d466fc03 on flight 4378
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7424 with session sess_1759153997171_0d053331
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4736
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1054 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6456 and payment ID pay_b10ea1383e344305
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997002_a8f0d241. payment ID: pay_b10ea1383e344305
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b10ea1383e344305, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997142_af8e460e on flight 7767
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1225, 1770, 4929], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997227_4968ef64
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1054 with session sess_1759153997017_df5609bf
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1225
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4118 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4378
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4118 with session sess_1759153997109_025e1ebd
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_81e35eb7d1c84750 across 2 flights for session sess_1759153997058_d466fc03
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7215, 6894, 6310], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997233_32977deb
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997142_7f4f1207 on flight 2495
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4455 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6457 with IN_PROGRESS status for session sess_1759153997058_d466fc03
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7767
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1149 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4455 with session sess_1759153997221_e080f93c
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[470, 5350, 4372], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997242_b77cfb54
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6457 and payment ID pay_81e35eb7d1c84750
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997058_d466fc03. payment ID: pay_81e35eb7d1c84750
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1149 with session sess_1759153997142_af8e460e
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_81e35eb7d1c84750, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2495
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3c838631d8b64002 across 1 flights for session sess_1759153997142_7f4f1207
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 788 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997004_629dc923 on flight 5800
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6458 with IN_PROGRESS status for session sess_1759153997142_7f4f1207
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 788 with session sess_1759153997210_41f994fd
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997109_025e1ebd on flight 4118
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997198_2f97a0e4 on flight 904
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3088, 7698], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153997262_76448266
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6458 and payment ID pay_3c838631d8b64002
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997142_7f4f1207. payment ID: pay_3c838631d8b64002
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3c838631d8b64002, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5800
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_eaa67ee377c24199 across 3 flights for session sess_1759153997004_629dc923
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2473], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153997278_efeb9f9d
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7215 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997075_cc2abdd1 on flight 4879
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 904
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4118
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1392 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6459 with IN_PROGRESS status for session sess_1759153997004_629dc923
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_56fb3a604cf94685 across 1 flights for session sess_1759153997198_2f97a0e4
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997142_af8e460e on flight 1149
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997221_e080f93c on flight 4455
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1392 with session sess_1759153997109_025e1ebd
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1225 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7215 with session sess_1759153997233_32977deb
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997036_bdffe883 on flight 7359
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 470 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4879
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1225 with session sess_1759153997227_4968ef64
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f36e7cca152e4e4c across 2 flights for session sess_1759153997075_cc2abdd1
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6460 with IN_PROGRESS status for session sess_1759153997198_2f97a0e4
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997017_df5609bf on flight 1054
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 470 with session sess_1759153997242_b77cfb54
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6461 with IN_PROGRESS status for session sess_1759153997075_cc2abdd1
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4455
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3088 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1149
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7359
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6459 and payment ID pay_eaa67ee377c24199
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2473 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5466 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997004_629dc923. payment ID: pay_eaa67ee377c24199
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_eaa67ee377c24199, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997171_0d053331 on flight 7424
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_054f94941a994c4a across 2 flights for session sess_1759153997142_af8e460e
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5466 with session sess_1759153997036_bdffe883
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2473 with session sess_1759153997278_efeb9f9d
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6460 and payment ID pay_56fb3a604cf94685
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997198_2f97a0e4. payment ID: pay_56fb3a604cf94685
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_56fb3a604cf94685, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1054
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7ea2800311fc4882 across 1 flights for session sess_1759153997221_e080f93c
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3088 with session sess_1759153997262_76448266
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_6452f707f171424e across 3 flights for session sess_1759153997017_df5609bf
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6461 and payment ID pay_f36e7cca152e4e4c
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997075_cc2abdd1. payment ID: pay_f36e7cca152e4e4c
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6462 with IN_PROGRESS status for session sess_1759153997142_af8e460e
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f36e7cca152e4e4c, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7907, 2320], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153997313_6ce452a9
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6463 with IN_PROGRESS status for session sess_1759153997017_df5609bf
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7424
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6464 with IN_PROGRESS status for session sess_1759153997221_e080f93c
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6362 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[146, 2245, 6565], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997317_30723b68
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6462 and payment ID pay_054f94941a994c4a
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6362 with session sess_1759153997171_0d053331
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997142_af8e460e. payment ID: pay_054f94941a994c4a
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_054f94941a994c4a, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7625, 6173], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153997323_e8727ef4
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997210_41f994fd on flight 788
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6463 and payment ID pay_6452f707f171424e
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997017_df5609bf. payment ID: pay_6452f707f171424e
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_6452f707f171424e, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997109_025e1ebd on flight 1392
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6464 and payment ID pay_7ea2800311fc4882
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997221_e080f93c. payment ID: pay_7ea2800311fc4882
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7ea2800311fc4882, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1036, 3958], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997332_487f2ff1
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 788
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1840 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1840 with session sess_1759153997210_41f994fd
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3829, 2817, 959], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153997339_0842c5f2
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1392
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7625 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f612dcbeb19b442f across 3 flights for session sess_1759153997109_025e1ebd
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[197], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153997345_e759384a
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7625 with session sess_1759153997323_e8727ef4
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6465 with IN_PROGRESS status for session sess_1759153997109_025e1ebd
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 146 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7907 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 146 with session sess_1759153997317_30723b68
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 197 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997233_32977deb on flight 7215
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 197 with session sess_1759153997345_e759384a
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7907 with session sess_1759153997313_6ce452a9
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997262_76448266 on flight 3088
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1036 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6465 and payment ID pay_f612dcbeb19b442f
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1036 with session sess_1759153997332_487f2ff1
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997109_025e1ebd. payment ID: pay_f612dcbeb19b442f
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f612dcbeb19b442f, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997278_efeb9f9d on flight 2473
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7215
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6894 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3088
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7698 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2473
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6894 with session sess_1759153997233_32977deb
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7698 with session sess_1759153997262_76448266
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997210_41f994fd on flight 1840
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7940, 1861, 7793], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997383_7a59711b
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_cb471d6c6dec4587 across 1 flights for session sess_1759153997278_efeb9f9d
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6466 with IN_PROGRESS status for session sess_1759153997278_efeb9f9d
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1840
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6569 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997036_bdffe883 on flight 5466
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6569 with session sess_1759153997210_41f994fd
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3829 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6466 and payment ID pay_cb471d6c6dec4587
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3829 with session sess_1759153997339_0842c5f2
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997278_efeb9f9d. payment ID: pay_cb471d6c6dec4587
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_cb471d6c6dec4587, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3224, 4818, 6494], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997407_5b6490db
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5466
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_960a750a00784091 across 3 flights for session sess_1759153997036_bdffe883
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997233_32977deb on flight 6894
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997210_41f994fd on flight 6569
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997227_4968ef64 on flight 1225
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6467 with IN_PROGRESS status for session sess_1759153997036_bdffe883
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997242_b77cfb54 on flight 470
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6569
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997171_0d053331 on flight 6362
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997317_30723b68 on flight 146
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997323_e8727ef4 on flight 7625
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b97317f6448c4605 across 3 flights for session sess_1759153997210_41f994fd
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6894
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1225
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1770 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6310 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 470
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5350 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997313_6ce452a9 on flight 7907
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997339_0842c5f2 on flight 3829
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997345_e759384a on flight 197
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6467 and payment ID pay_960a750a00784091
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997036_bdffe883. payment ID: pay_960a750a00784091
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1770 with session sess_1759153997227_4968ef64
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6310 with session sess_1759153997233_32977deb
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_960a750a00784091, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5350 with session sess_1759153997242_b77cfb54
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6362
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5346 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5346 with session sess_1759153997171_0d053331
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6468 with IN_PROGRESS status for session sess_1759153997210_41f994fd
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7625
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6173 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 146
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7940 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2245 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7907
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2320 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3829
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2817 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2245 with session sess_1759153997317_30723b68
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6173 with session sess_1759153997323_e8727ef4
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7940 with session sess_1759153997383_7a59711b
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997332_487f2ff1 on flight 1036
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2817 with session sess_1759153997339_0842c5f2
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7732, 1794], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997451_c4ac0404
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2320 with session sess_1759153997313_6ce452a9
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3224 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 197
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_365b602940cd48b1 across 1 flights for session sess_1759153997345_e759384a
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6468 and payment ID pay_b97317f6448c4605
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997210_41f994fd. payment ID: pay_b97317f6448c4605
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b97317f6448c4605, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3224 with session sess_1759153997407_5b6490db
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1036
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3958 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3958 with session sess_1759153997332_487f2ff1
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6469 with IN_PROGRESS status for session sess_1759153997345_e759384a
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997262_76448266 on flight 7698
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6469 and payment ID pay_365b602940cd48b1
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997345_e759384a. payment ID: pay_365b602940cd48b1
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_365b602940cd48b1, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4831, 5864], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153997470_b5cf2d53
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7732 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7732 with session sess_1759153997451_c4ac0404
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7698
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_02052abdb4554bec across 2 flights for session sess_1759153997262_76448266
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4150], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153997482_96b73139
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6470 with IN_PROGRESS status for session sess_1759153997262_76448266
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4831 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997407_5b6490db on flight 3224
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6470 and payment ID pay_02052abdb4554bec
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997262_76448266. payment ID: pay_02052abdb4554bec
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_02052abdb4554bec, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997233_32977deb on flight 6310
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4831 with session sess_1759153997470_b5cf2d53
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997242_b77cfb54 on flight 5350
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[669, 1905, 3619], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997505_4b3031cd
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6310
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997323_e8727ef4 on flight 6173
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3224
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4818 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_04476bf109664579 across 3 flights for session sess_1759153997233_32977deb
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4818 with session sess_1759153997407_5b6490db
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6471 with IN_PROGRESS status for session sess_1759153997233_32977deb
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997339_0842c5f2 on flight 2817
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4150 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997451_c4ac0404 on flight 7732
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5350
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4372 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4150 with session sess_1759153997482_96b73139
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997227_4968ef64 on flight 1770
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997171_0d053331 on flight 5346
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4372 with session sess_1759153997242_b77cfb54
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6173
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997383_7a59711b on flight 7940
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997313_6ce452a9 on flight 2320
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997332_487f2ff1 on flight 3958
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6471 and payment ID pay_04476bf109664579
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997233_32977deb. payment ID: pay_04476bf109664579
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_04476bf109664579, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_42d4e8437be2409f across 2 flights for session sess_1759153997323_e8727ef4
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997317_30723b68 on flight 2245
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2817
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7732
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1794 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 959 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1770
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4929 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1794 with session sess_1759153997451_c4ac0404
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5346
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6472 with IN_PROGRESS status for session sess_1759153997323_e8727ef4
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 959 with session sess_1759153997339_0842c5f2
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4929 with session sess_1759153997227_4968ef64
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5109, 877, 289], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153997554_2a4fe1c2
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3958
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7940
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1861 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1861 with session sess_1759153997383_7a59711b
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_07e1a69d6b3c40d7 across 3 flights for session sess_1759153997171_0d053331
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2245
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6565 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6565 with session sess_1759153997317_30723b68
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_dae452d04f86493b across 2 flights for session sess_1759153997332_487f2ff1
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6472 and payment ID pay_42d4e8437be2409f
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997323_e8727ef4. payment ID: pay_42d4e8437be2409f
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_42d4e8437be2409f, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 669 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2320
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6474 with IN_PROGRESS status for session sess_1759153997171_0d053331
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6473 with IN_PROGRESS status for session sess_1759153997332_487f2ff1
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 669 with session sess_1759153997505_4b3031cd
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d33f5217b7884194 across 2 flights for session sess_1759153997313_6ce452a9
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6475 with IN_PROGRESS status for session sess_1759153997313_6ce452a9
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997470_b5cf2d53 on flight 4831
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997482_96b73139 on flight 4150
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1474], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153997584_9f58e1ce
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4831
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5864 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5864 with session sess_1759153997470_b5cf2d53
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997339_0842c5f2 on flight 959
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6474 and payment ID pay_07e1a69d6b3c40d7
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997171_0d053331. payment ID: pay_07e1a69d6b3c40d7
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_07e1a69d6b3c40d7, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6473 and payment ID pay_dae452d04f86493b
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1474 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997332_487f2ff1. payment ID: pay_dae452d04f86493b
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_dae452d04f86493b, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6475 and payment ID pay_d33f5217b7884194
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4150
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997313_6ce452a9. payment ID: pay_d33f5217b7884194
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d33f5217b7884194, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1474 with session sess_1759153997584_9f58e1ce
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997383_7a59711b on flight 1861
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 959
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0e3634d62971408a across 3 flights for session sess_1759153997339_0842c5f2
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7461, 4464, 4407], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997605_b22494db
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5479, 2930], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997606_273255e4
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4be9f3af5c9d419e across 1 flights for session sess_1759153997482_96b73139
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5109 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7887, 3263], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153997609_3aa21aa9
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5109 with session sess_1759153997554_2a4fe1c2
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6476 with IN_PROGRESS status for session sess_1759153997339_0842c5f2
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1861
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7793 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997242_b77cfb54 on flight 4372
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7793 with session sess_1759153997383_7a59711b
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6476 and payment ID pay_0e3634d62971408a
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997339_0842c5f2. payment ID: pay_0e3634d62971408a
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0e3634d62971408a, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997470_b5cf2d53 on flight 5864
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5479 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5479 with session sess_1759153997606_273255e4
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6477 with IN_PROGRESS status for session sess_1759153997482_96b73139
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997451_c4ac0404 on flight 1794
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997407_5b6490db on flight 4818
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7887 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7887 with session sess_1759153997609_3aa21aa9
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3906], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153997637_67c33880
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5864
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997505_4b3031cd on flight 669
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1794
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6477 and payment ID pay_4be9f3af5c9d419e
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997482_96b73139. payment ID: pay_4be9f3af5c9d419e
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4372
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4be9f3af5c9d419e, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4818
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6494 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7461 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_14844d08658b4f3d across 3 flights for session sess_1759153997242_b77cfb54
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7461 with session sess_1759153997605_b22494db
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7aae9eb35575438b across 2 flights for session sess_1759153997451_c4ac0404
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 669
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997554_2a4fe1c2 on flight 5109
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1905 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5071, 5256, 807], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153997655_b3752050
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6494 with session sess_1759153997407_5b6490db
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_46c61154865349e8 across 2 flights for session sess_1759153997470_b5cf2d53
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1905 with session sess_1759153997505_4b3031cd
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6478 with IN_PROGRESS status for session sess_1759153997242_b77cfb54
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3906 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6479 with IN_PROGRESS status for session sess_1759153997470_b5cf2d53
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997317_30723b68 on flight 6565
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3906 with session sess_1759153997637_67c33880
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997383_7a59711b on flight 7793
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6480 with IN_PROGRESS status for session sess_1759153997451_c4ac0404
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997609_3aa21aa9 on flight 7887
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997227_4968ef64 on flight 4929
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6478 and payment ID pay_14844d08658b4f3d
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997242_b77cfb54. payment ID: pay_14844d08658b4f3d
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997584_9f58e1ce on flight 1474
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_14844d08658b4f3d, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7793
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5109
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 877 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c6880217a53e4510 across 3 flights for session sess_1759153997383_7a59711b
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6565
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 877 with session sess_1759153997554_2a4fe1c2
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6479 and payment ID pay_46c61154865349e8
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997470_b5cf2d53. payment ID: pay_46c61154865349e8
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_46c61154865349e8, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1474
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7887
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6480 and payment ID pay_7aae9eb35575438b
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3263 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997451_c4ac0404. payment ID: pay_7aae9eb35575438b
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7aae9eb35575438b, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2447, 2862, 4946], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153997690_8220c705
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3263 with session sess_1759153997609_3aa21aa9
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4929
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997606_273255e4 on flight 5479
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_aaba832ca0b040bb across 1 flights for session sess_1759153997584_9f58e1ce
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3127682ec7e14b06 across 3 flights for session sess_1759153997227_4968ef64
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6481 with IN_PROGRESS status for session sess_1759153997383_7a59711b
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6482 with IN_PROGRESS status for session sess_1759153997584_9f58e1ce
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997407_5b6490db on flight 6494
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5479
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2930 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4874, 3028], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153997699_c667b079
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6483 with IN_PROGRESS status for session sess_1759153997227_4968ef64
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2478, 3464, 5928], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997701_d5c1d573
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2930 with session sess_1759153997606_273255e4
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8ec82fef9c284df4 across 3 flights for session sess_1759153997317_30723b68
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6483 and payment ID pay_3127682ec7e14b06
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997227_4968ef64. payment ID: pay_3127682ec7e14b06
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3127682ec7e14b06, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6484 with IN_PROGRESS status for session sess_1759153997317_30723b68
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6494
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3aa656b47e224ade across 3 flights for session sess_1759153997407_5b6490db
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5071 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6485 with IN_PROGRESS status for session sess_1759153997407_5b6490db
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5071 with session sess_1759153997655_b3752050
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6484 and payment ID pay_8ec82fef9c284df4
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997317_30723b68. payment ID: pay_8ec82fef9c284df4
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8ec82fef9c284df4, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6485 and payment ID pay_3aa656b47e224ade
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997407_5b6490db. payment ID: pay_3aa656b47e224ade
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3aa656b47e224ade, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7652, 5945, 1615], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997720_049cb102
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6482 and payment ID pay_aaba832ca0b040bb
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997584_9f58e1ce. payment ID: pay_aaba832ca0b040bb
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_aaba832ca0b040bb, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2447 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[386, 2442, 1056], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997728_4de4e79b
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2447 with session sess_1759153997690_8220c705
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6481 and payment ID pay_c6880217a53e4510
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997383_7a59711b. payment ID: pay_c6880217a53e4510
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c6880217a53e4510, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4874 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4749, 5992], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997732_ac6b54f4
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4874 with session sess_1759153997699_c667b079
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2879, 2921], seatCount=3)]
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153997737_5bd2b0d6
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997605_b22494db on flight 7461
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997637_67c33880 on flight 3906
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5987], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153997744_e9b4e993
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2478 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2478 with session sess_1759153997701_d5c1d573
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7461
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997505_4b3031cd on flight 1905
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997655_b3752050 on flight 5071
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4464 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7652 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4464 with session sess_1759153997605_b22494db
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7652 with session sess_1759153997720_049cb102
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997554_2a4fe1c2 on flight 877
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4749 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3906
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5071
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5256 (leg 2/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4749 with session sess_1759153997732_ac6b54f4
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_188f296aa1f7455e across 1 flights for session sess_1759153997637_67c33880
2025-09-29 19:23:17 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1905
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3619 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5256 with session sess_1759153997655_b3752050
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5987 (leg 1/1)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997609_3aa21aa9 on flight 3263
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997606_273255e4 on flight 2930
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2879 (leg 1/2)
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6486 with IN_PROGRESS status for session sess_1759153997637_67c33880
2025-09-29 19:23:17 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2879 with session sess_1759153997737_5bd2b0d6
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3619 with session sess_1759153997505_4b3031cd
2025-09-29 19:23:17 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5987 with session sess_1759153997744_e9b4e993
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 877
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 289 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3263
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 386 (leg 1/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_af2877af69ae47ba across 2 flights for session sess_1759153997609_3aa21aa9
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 386 with session sess_1759153997728_4de4e79b
2025-09-29 19:23:17 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 289 with session sess_1759153997554_2a4fe1c2
2025-09-29 19:23:17 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2930
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b99bea9accdb4e96 across 2 flights for session sess_1759153997606_273255e4
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997605_b22494db on flight 4464
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6487 with IN_PROGRESS status for session sess_1759153997609_3aa21aa9
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6488 with IN_PROGRESS status for session sess_1759153997606_273255e4
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6486 and payment ID pay_188f296aa1f7455e
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997637_67c33880. payment ID: pay_188f296aa1f7455e
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_188f296aa1f7455e, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4464
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4407 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6487 and payment ID pay_af2877af69ae47ba
2025-09-29 19:23:17 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4407 with session sess_1759153997605_b22494db
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997609_3aa21aa9. payment ID: pay_af2877af69ae47ba
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_af2877af69ae47ba, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997699_c667b079 on flight 4874
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997655_b3752050 on flight 5256
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6488 and payment ID pay_b99bea9accdb4e96
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997606_273255e4. payment ID: pay_b99bea9accdb4e96
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b99bea9accdb4e96, fli (truncated)...]
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7660, 6617], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153997805_1b277574
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7455], seatCount=2)]
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153997808_ef5c7852
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1765, 2698, 1837], seatCount=1)]
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:17 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153997816_1944f23d
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4874
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3028 (leg 2/2)
2025-09-29 19:23:17 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3028 with session sess_1759153997699_c667b079
2025-09-29 19:23:17 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5256
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 807 (leg 3/3)
2025-09-29 19:23:17 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997701_d5c1d573 on flight 2478
2025-09-29 19:23:17 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997720_049cb102 on flight 7652
2025-09-29 19:23:17 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 807 with session sess_1759153997655_b3752050
2025-09-29 19:23:17 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:17 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997690_8220c705 on flight 2447
2025-09-29 19:23:17 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:17 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:17 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7455 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997605_b22494db on flight 4407
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997737_5bd2b0d6 on flight 2879
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7455 with session sess_1759153997808_ef5c7852
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7660 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7660 with session sess_1759153997805_1b277574
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2478
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3464 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997732_ac6b54f4 on flight 4749
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997699_c667b079 on flight 3028
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3464 with session sess_1759153997701_d5c1d573
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997728_4de4e79b on flight 386
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997744_e9b4e993 on flight 5987
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997554_2a4fe1c2 on flight 289
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997505_4b3031cd on flight 3619
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2879
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2921 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2447
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7652
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5945 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2862 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4749
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5992 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5945 with session sess_1759153997720_049cb102
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2921 with session sess_1759153997737_5bd2b0d6
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2862 with session sess_1759153997690_8220c705
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4407
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997701_d5c1d573 on flight 3464
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d54b224c079f4646 across 3 flights for session sess_1759153997605_b22494db
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 386
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5992 with session sess_1759153997732_ac6b54f4
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2442 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3028
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997655_b3752050 on flight 807
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1765 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5987
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7a46c187a78b48bc across 2 flights for session sess_1759153997699_c667b079
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1765 with session sess_1759153997816_1944f23d
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f3784b10ea4445f8 across 1 flights for session sess_1759153997744_e9b4e993
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2442 with session sess_1759153997728_4de4e79b
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 289
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3619
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6489 with IN_PROGRESS status for session sess_1759153997605_b22494db
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6490 with IN_PROGRESS status for session sess_1759153997744_e9b4e993
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997805_1b277574 on flight 7660
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_37a8e890bc964a60 across 3 flights for session sess_1759153997505_4b3031cd
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6491 with IN_PROGRESS status for session sess_1759153997699_c667b079
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_59092bc5bff24a0d across 3 flights for session sess_1759153997554_2a4fe1c2
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997808_ef5c7852 on flight 7455
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 807
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6492 with IN_PROGRESS status for session sess_1759153997505_4b3031cd
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997720_049cb102 on flight 5945
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6493 with IN_PROGRESS status for session sess_1759153997554_2a4fe1c2
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f37f8b516c8f44df across 3 flights for session sess_1759153997655_b3752050
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3464
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5928 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997690_8220c705 on flight 2862
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5928 with session sess_1759153997701_d5c1d573
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6489 and payment ID pay_d54b224c079f4646
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6491 and payment ID pay_7a46c187a78b48bc
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7660
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6617 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997605_b22494db. payment ID: pay_d54b224c079f4646
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6494 with IN_PROGRESS status for session sess_1759153997655_b3752050
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997699_c667b079. payment ID: pay_7a46c187a78b48bc
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997728_4de4e79b on flight 2442
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6490 and payment ID pay_f3784b10ea4445f8
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997744_e9b4e993. payment ID: pay_f3784b10ea4445f8
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f3784b10ea4445f8, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d54b224c079f4646, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7a46c187a78b48bc, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7455
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997737_5bd2b0d6 on flight 2921
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6617 with session sess_1759153997805_1b277574
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_04e585320081455e across 1 flights for session sess_1759153997808_ef5c7852
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6493 and payment ID pay_59092bc5bff24a0d
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997554_2a4fe1c2. payment ID: pay_59092bc5bff24a0d
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6492 and payment ID pay_37a8e890bc964a60
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997505_4b3031cd. payment ID: pay_37a8e890bc964a60
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5945
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1615 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_59092bc5bff24a0d, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_37a8e890bc964a60, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[24], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5503, 2448, 1923], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153998366_6f4ba568
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153998366_ac264405
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7110], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153998368_f7027673
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997816_1944f23d on flight 1765
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997732_ac6b54f4 on flight 5992
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1615 with session sess_1759153997720_049cb102
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2862
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4946 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4946 with session sess_1759153997690_8220c705
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3507], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4152, 5382], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153998379_7e518aad
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153998379_12d1f6f8
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6495 with IN_PROGRESS status for session sess_1759153997808_ef5c7852
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6494 and payment ID pay_f37f8b516c8f44df
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997655_b3752050. payment ID: pay_f37f8b516c8f44df
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997701_d5c1d573 on flight 5928
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f37f8b516c8f44df, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2442
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1056 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 24 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2921
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1765
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2698 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5124, 4637], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153998396_51d8cf6c
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1056 with session sess_1759153997728_4de4e79b
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c5f5a42b98c04d7f across 2 flights for session sess_1759153997737_5bd2b0d6
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5992
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2698 with session sess_1759153997816_1944f23d
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 24 with session sess_1759153998366_6f4ba568
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9eaba80563af457d across 2 flights for session sess_1759153997732_ac6b54f4
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7110 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6496 with IN_PROGRESS status for session sess_1759153997737_5bd2b0d6
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3507 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6495 and payment ID pay_04e585320081455e
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997808_ef5c7852. payment ID: pay_04e585320081455e
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_04e585320081455e, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6497 with IN_PROGRESS status for session sess_1759153997732_ac6b54f4
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5928
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3507 with session sess_1759153998379_7e518aad
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ec810078f1674d4f across 3 flights for session sess_1759153997701_d5c1d573
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7110 with session sess_1759153998368_f7027673
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1588, 1023, 7622], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153998434_5a0b3c62
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153997690_8220c705 on flight 4946
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6498 with IN_PROGRESS status for session sess_1759153997701_d5c1d573
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997728_4de4e79b on flight 1056
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153997805_1b277574 on flight 6617
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998379_7e518aad on flight 3507
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998366_6f4ba568 on flight 24
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4152 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6496 and payment ID pay_c5f5a42b98c04d7f
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997737_5bd2b0d6. payment ID: pay_c5f5a42b98c04d7f
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c5f5a42b98c04d7f, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5124 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5124 with session sess_1759153998396_51d8cf6c
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4152 with session sess_1759153998379_12d1f6f8
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4946
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3507
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6498 and payment ID pay_ec810078f1674d4f
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6497 and payment ID pay_9eaba80563af457d
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997732_ac6b54f4. payment ID: pay_9eaba80563af457d
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997701_d5c1d573. payment ID: pay_ec810078f1674d4f
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9eaba80563af457d, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ec810078f1674d4f, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1056
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997816_1944f23d on flight 2698
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_312c4deccd1b4a96 across 3 flights for session sess_1759153997690_8220c705
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e7b8fb98f6624ec2 across 3 flights for session sess_1759153997728_4de4e79b
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7094], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153998480_26d92a59
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 24
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3c00b4fd7afd457b across 1 flights for session sess_1759153998379_7e518aad
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2698
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1837 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5503 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[823, 7257, 2068], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6772, 6831, 2940], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153998487_ca3048bc
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153998487_4fcceea4
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6499 with IN_PROGRESS status for session sess_1759153998379_7e518aad
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1837 with session sess_1759153997816_1944f23d
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5503 with session sess_1759153998366_ac264405
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b182357cc92f4936 across 1 flights for session sess_1759153998366_6f4ba568
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6500 with IN_PROGRESS status for session sess_1759153997690_8220c705
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6501 with IN_PROGRESS status for session sess_1759153997728_4de4e79b
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998368_f7027673 on flight 7110
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6502 with IN_PROGRESS status for session sess_1759153998366_6f4ba568
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7094 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7094 with session sess_1759153998480_26d92a59
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6499 and payment ID pay_3c00b4fd7afd457b
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998379_7e518aad. payment ID: pay_3c00b4fd7afd457b
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3c00b4fd7afd457b, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6617
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6502 and payment ID pay_b182357cc92f4936
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6501 and payment ID pay_e7b8fb98f6624ec2
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997728_4de4e79b. payment ID: pay_e7b8fb98f6624ec2
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998366_6f4ba568. payment ID: pay_b182357cc92f4936
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e7b8fb98f6624ec2, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b182357cc92f4936, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7110
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6500 and payment ID pay_312c4deccd1b4a96
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997690_8220c705. payment ID: pay_312c4deccd1b4a96
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_312c4deccd1b4a96, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998379_12d1f6f8 on flight 4152
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1588 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e5a748c6ad854764 across 2 flights for session sess_1759153997805_1b277574
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1588 with session sess_1759153998434_5a0b3c62
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6503 with IN_PROGRESS status for session sess_1759153997805_1b277574
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7026, 4590], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153998543_9035452e
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4152, 169, 2354], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153998545_719704e6
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2814], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153998545_12ea828b
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7207, 3105, 3973], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153998546_5f00be83
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_af967e89a2064da5 across 1 flights for session sess_1759153998368_f7027673
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6504 with IN_PROGRESS status for session sess_1759153998368_f7027673
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4152
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5382 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998396_51d8cf6c on flight 5124
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5382 with session sess_1759153998379_12d1f6f8
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997816_1944f23d on flight 1837
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2814 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998434_5a0b3c62 on flight 1588
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998480_26d92a59 on flight 7094
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153997720_049cb102 on flight 1615
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6504 and payment ID pay_af967e89a2064da5
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998368_f7027673. payment ID: pay_af967e89a2064da5
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_af967e89a2064da5, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6503 and payment ID pay_e5a748c6ad854764
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5124
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997805_1b277574. payment ID: pay_e5a748c6ad854764
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4637 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e5a748c6ad854764, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4637 with session sess_1759153998396_51d8cf6c
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6772 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6772 with session sess_1759153998487_4fcceea4
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1588
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1023 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7094
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1837
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c3af33efc27f4194 across 1 flights for session sess_1759153998480_26d92a59
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4407, 5923], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[774], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153998590_c67988aa
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 823 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153998590_28eaffbf
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7026 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1023 with session sess_1759153998434_5a0b3c62
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2814 with session sess_1759153998545_12ea828b
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7026 with session sess_1759153998543_9035452e
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6505 with IN_PROGRESS status for session sess_1759153998480_26d92a59
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1615
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_29c968eff866497e across 3 flights for session sess_1759153997720_049cb102
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4152 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 823 with session sess_1759153998487_ca3048bc
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7207 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4152 with session sess_1759153998545_719704e6
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6506 with IN_PROGRESS status for session sess_1759153997720_049cb102
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d28edd34e0e649c0 across 3 flights for session sess_1759153997816_1944f23d
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6505 and payment ID pay_c3af33efc27f4194
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998480_26d92a59. payment ID: pay_c3af33efc27f4194
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c3af33efc27f4194, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4407 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4407 with session sess_1759153998590_c67988aa
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7207 with session sess_1759153998546_5f00be83
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6507 with IN_PROGRESS status for session sess_1759153997816_1944f23d
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6506 and payment ID pay_29c968eff866497e
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997720_049cb102. payment ID: pay_29c968eff866497e
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_29c968eff866497e, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 774 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 774 with session sess_1759153998590_28eaffbf
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6507 and payment ID pay_d28edd34e0e649c0
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153997816_1944f23d. payment ID: pay_d28edd34e0e649c0
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d28edd34e0e649c0, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[297, 3760, 284], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153998620_4b73bc2a
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998366_ac264405 on flight 5503
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7189, 2409], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153998625_8020b2f7
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5503
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2448 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1080, 3250], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153998630_e3ad1624
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2448 with session sess_1759153998366_ac264405
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998543_9035452e on flight 7026
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998545_12ea828b on flight 2814
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998379_12d1f6f8 on flight 5382
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5382
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998434_5a0b3c62 on flight 1023
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2814
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_39b8335b11fa40d5 across 2 flights for session sess_1759153998379_12d1f6f8
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1080 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1080 with session sess_1759153998630_e3ad1624
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7026
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4590 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998487_4fcceea4 on flight 6772
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6508 with IN_PROGRESS status for session sess_1759153998379_12d1f6f8
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_1c4051e497f64b3f across 1 flights for session sess_1759153998545_12ea828b
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4590 with session sess_1759153998543_9035452e
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998487_ca3048bc on flight 823
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998546_5f00be83 on flight 7207
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7189 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1023
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7622 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6508 and payment ID pay_39b8335b11fa40d5
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7622 with session sess_1759153998434_5a0b3c62
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7189 with session sess_1759153998625_8020b2f7
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998379_12d1f6f8. payment ID: pay_39b8335b11fa40d5
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_39b8335b11fa40d5, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998590_28eaffbf on flight 774
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6509 with IN_PROGRESS status for session sess_1759153998545_12ea828b
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998396_51d8cf6c on flight 4637
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 297 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 823
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7257 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 297 with session sess_1759153998620_4b73bc2a
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998545_719704e6 on flight 4152
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7257 with session sess_1759153998487_ca3048bc
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6946], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153998682_a6f62775
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4637
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6509 and payment ID pay_1c4051e497f64b3f
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998545_12ea828b. payment ID: pay_1c4051e497f64b3f
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_1c4051e497f64b3f, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998590_c67988aa on flight 4407
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6772
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6831 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998366_ac264405 on flight 2448
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7207
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3105 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e896cac6fecf45c0 across 2 flights for session sess_1759153998396_51d8cf6c
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3105 with session sess_1759153998546_5f00be83
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4407
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5923 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6510 with IN_PROGRESS status for session sess_1759153998396_51d8cf6c
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5923 with session sess_1759153998590_c67988aa
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1454], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153998701_c90e141d
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6831 with session sess_1759153998487_4fcceea4
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 774
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5edff533fe44424b across 1 flights for session sess_1759153998590_28eaffbf
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4152
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 169 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6946 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2448
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1923 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6510 and payment ID pay_e896cac6fecf45c0
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998396_51d8cf6c. payment ID: pay_e896cac6fecf45c0
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e896cac6fecf45c0, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6511 with IN_PROGRESS status for session sess_1759153998590_28eaffbf
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1923 with session sess_1759153998366_ac264405
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1454 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1454 with session sess_1759153998701_c90e141d
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 169 with session sess_1759153998545_719704e6
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6946 with session sess_1759153998682_a6f62775
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998620_4b73bc2a on flight 297
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[680], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153998727_935193e3
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6511 and payment ID pay_5edff533fe44424b
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998590_28eaffbf. payment ID: pay_5edff533fe44424b
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998630_e3ad1624 on flight 1080
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5edff533fe44424b, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 297
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3760 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998543_9035452e on flight 4590
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3760 with session sess_1759153998620_4b73bc2a
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2638, 2166, 6171], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153998742_de13f424
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998546_5f00be83 on flight 3105
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998487_4fcceea4 on flight 6831
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 680 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 680 with session sess_1759153998727_935193e3
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998545_719704e6 on flight 169
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998487_ca3048bc on flight 7257
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3105
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3973 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998625_8020b2f7 on flight 7189
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3973 with session sess_1759153998546_5f00be83
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4590
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 169
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2354 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998434_5a0b3c62 on flight 7622
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6831
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2940 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2354 with session sess_1759153998545_719704e6
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998682_a6f62775 on flight 6946
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2940 with session sess_1759153998487_4fcceea4
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998701_c90e141d on flight 1454
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1080
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3250 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7257
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2068 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7189
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2409 (leg 2/2)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a63c5b812b3c406a across 2 flights for session sess_1759153998543_9035452e
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2068 with session sess_1759153998487_ca3048bc
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3250 with session sess_1759153998630_e3ad1624
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998590_c67988aa on flight 5923
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7622
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6512 with IN_PROGRESS status for session sess_1759153998543_9035452e
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f47553d9e17a40d8 across 3 flights for session sess_1759153998434_5a0b3c62
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2409 with session sess_1759153998625_8020b2f7
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2638 (leg 1/3)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2638 with session sess_1759153998742_de13f424
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998545_719704e6 on flight 2354
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6513 with IN_PROGRESS status for session sess_1759153998434_5a0b3c62
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998727_935193e3 on flight 680
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6946
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1454
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5923
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_bab77b12371a4676 across 1 flights for session sess_1759153998682_a6f62775
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 680
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_216436ed8c1e4737 across 2 flights for session sess_1759153998590_c67988aa
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c814260e03434b12 across 1 flights for session sess_1759153998727_935193e3
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6514 with IN_PROGRESS status for session sess_1759153998682_a6f62775
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6516 with IN_PROGRESS status for session sess_1759153998727_935193e3
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6515 with IN_PROGRESS status for session sess_1759153998590_c67988aa
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6513 and payment ID pay_f47553d9e17a40d8
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998434_5a0b3c62. payment ID: pay_f47553d9e17a40d8
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998620_4b73bc2a on flight 3760
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f47553d9e17a40d8, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a74766ca4f584a56 across 1 flights for session sess_1759153998701_c90e141d
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2354
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998487_ca3048bc on flight 2068
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6512 and payment ID pay_a63c5b812b3c406a
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6516 and payment ID pay_c814260e03434b12
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998543_9035452e. payment ID: pay_a63c5b812b3c406a
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998727_935193e3. payment ID: pay_c814260e03434b12
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c814260e03434b12, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6514 and payment ID pay_bab77b12371a4676
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998682_a6f62775. payment ID: pay_bab77b12371a4676
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a63c5b812b3c406a, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7f455c76cb9e4d11 across 3 flights for session sess_1759153998545_719704e6
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_bab77b12371a4676, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6517 with IN_PROGRESS status for session sess_1759153998701_c90e141d
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6515 and payment ID pay_216436ed8c1e4737
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998590_c67988aa. payment ID: pay_216436ed8c1e4737
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_216436ed8c1e4737, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6518 with IN_PROGRESS status for session sess_1759153998545_719704e6
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6585, 3624], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153998883_53852792
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2068
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[856, 3959, 1710], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7743], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1048, 2782, 464], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153998889_df787539
2025-09-29 19:23:18 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153998889_7c20f381
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153998889_0a1ffc97
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_bc10936baf8c4bfc across 3 flights for session sess_1759153998487_ca3048bc
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5009, 7937], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153998893_f9ad39b2
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998546_5f00be83 on flight 3973
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6519 with IN_PROGRESS status for session sess_1759153998487_ca3048bc
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6517 and payment ID pay_a74766ca4f584a56
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998630_e3ad1624 on flight 3250
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998701_c90e141d. payment ID: pay_a74766ca4f584a56
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998742_de13f424 on flight 2638
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a74766ca4f584a56, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6519 and payment ID pay_bc10936baf8c4bfc
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998487_ca3048bc. payment ID: pay_bc10936baf8c4bfc
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6518 and payment ID pay_7f455c76cb9e4d11
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998545_719704e6. payment ID: pay_7f455c76cb9e4d11
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7f455c76cb9e4d11, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_bc10936baf8c4bfc, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3760
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 284 (leg 3/3)
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3973
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 284 with session sess_1759153998620_4b73bc2a
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998366_ac264405 on flight 1923
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3837], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153998926_7bebc322
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4430, 141], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2161, 2439], seatCount=3)]
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153998930_2a45d823
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153998930_8b48e359
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_619a79321bdd436d across 3 flights for session sess_1759153998546_5f00be83
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998625_8020b2f7 on flight 2409
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6520 with IN_PROGRESS status for session sess_1759153998546_5f00be83
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1923
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7743 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7743 with session sess_1759153998889_df787539
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3250
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8c57a76904614b61 across 3 flights for session sess_1759153998366_ac264405
2025-09-29 19:23:18 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b7bfbddfcce34afb across 2 flights for session sess_1759153998630_e3ad1624
2025-09-29 19:23:18 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6521 with IN_PROGRESS status for session sess_1759153998366_ac264405
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3837 (leg 1/1)
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3837 with session sess_1759153998926_7bebc322
2025-09-29 19:23:18 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998487_4fcceea4 on flight 2940
2025-09-29 19:23:18 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6522 with IN_PROGRESS status for session sess_1759153998630_e3ad1624
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4430 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2638
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2166 (leg 2/3)
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6520 and payment ID pay_619a79321bdd436d
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998546_5f00be83. payment ID: pay_619a79321bdd436d
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_619a79321bdd436d, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6521 and payment ID pay_8c57a76904614b61
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998366_ac264405. payment ID: pay_8c57a76904614b61
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8c57a76904614b61, fli (truncated)...]
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2409
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:18 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4430 with session sess_1759153998930_2a45d823
2025-09-29 19:23:18 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2940
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_52afdb36bd1544f7 across 2 flights for session sess_1759153998625_8020b2f7
2025-09-29 19:23:18 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_bd3de2764300489b across 3 flights for session sess_1759153998487_4fcceea4
2025-09-29 19:23:18 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:18 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2166 with session sess_1759153998742_de13f424
2025-09-29 19:23:18 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5009 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998620_4b73bc2a on flight 284
2025-09-29 19:23:18 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5009 with session sess_1759153998893_f9ad39b2
2025-09-29 19:23:18 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:18 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6523 with IN_PROGRESS status for session sess_1759153998625_8020b2f7
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4075, 4213], seatCount=2)]
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5327], seatCount=1)]
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153998990_5692cc13
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:18 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759153998990_641a0f46
2025-09-29 19:23:18 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6524 with IN_PROGRESS status for session sess_1759153998487_4fcceea4
2025-09-29 19:23:18 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:18 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2161 (leg 1/2)
2025-09-29 19:23:18 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6585 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6522 and payment ID pay_b7bfbddfcce34afb
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998630_e3ad1624. payment ID: pay_b7bfbddfcce34afb
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b7bfbddfcce34afb, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6585 with session sess_1759153998883_53852792
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1048 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 284
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2161 with session sess_1759153998930_8b48e359
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6680, 5834], seatCount=3)]
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153999027_c482fa8f
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6524 and payment ID pay_bd3de2764300489b
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998487_4fcceea4. payment ID: pay_bd3de2764300489b
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_bd3de2764300489b, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998889_df787539 on flight 7743
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998926_7bebc322 on flight 3837
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7743
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 856 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998930_8b48e359 on flight 2161
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3196, 6257, 1344], seatCount=1)]
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_93568be4ea20494c across 3 flights for session sess_1759153998620_4b73bc2a
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e6749288914045a4 across 1 flights for session sess_1759153998889_df787539
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153999049_b82cf4a2
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 856 with session sess_1759153998889_7c20f381
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6526 with IN_PROGRESS status for session sess_1759153998620_4b73bc2a
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6525 with IN_PROGRESS status for session sess_1759153998889_df787539
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998742_de13f424 on flight 2166
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3837
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6523 and payment ID pay_52afdb36bd1544f7
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998625_8020b2f7. payment ID: pay_52afdb36bd1544f7
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_52afdb36bd1544f7, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5327 (leg 1/1)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998883_53852792 on flight 6585
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2161
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2439 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5d3e5def75a84863 across 1 flights for session sess_1759153998926_7bebc322
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998930_2a45d823 on flight 4430
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5327 with session sess_1759153998990_641a0f46
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6525 and payment ID pay_e6749288914045a4
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998889_df787539. payment ID: pay_e6749288914045a4
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e6749288914045a4, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6526 and payment ID pay_93568be4ea20494c
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998620_4b73bc2a. payment ID: pay_93568be4ea20494c
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_93568be4ea20494c, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6527 with IN_PROGRESS status for session sess_1759153998926_7bebc322
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[753, 1553, 6228], seatCount=1)]
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153999074_84749fc7
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2439 with session sess_1759153998930_8b48e359
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1048 with session sess_1759153998889_0a1ffc97
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6585
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3624 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3624 with session sess_1759153998883_53852792
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1200, 656, 3705], seatCount=1)]
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153999085_acbb3636
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2166
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6171 (leg 3/3)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6527 and payment ID pay_5d3e5def75a84863
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998926_7bebc322. payment ID: pay_5d3e5def75a84863
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4430
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 141 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6171 with session sess_1759153998742_de13f424
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5d3e5def75a84863, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6292], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153999091_f5806b7e
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998889_7c20f381 on flight 856
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4075 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6680 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 141 with session sess_1759153998930_2a45d823
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4075 with session sess_1759153998990_5692cc13
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6680 with session sess_1759153999027_c482fa8f
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998990_641a0f46 on flight 5327
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3943, 178], seatCount=1)]
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153999105_95605b7d
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3196 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3196 with session sess_1759153999049_b82cf4a2
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 856
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3959 (leg 2/3)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6292 (leg 1/1)
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 3959 with session sess_1759153998889_7c20f381
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6292 with session sess_1759153999091_f5806b7e
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5327
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998889_0a1ffc97 on flight 1048
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_233d5fc11fb84c9a across 1 flights for session sess_1759153998990_641a0f46
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 753 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6528 with IN_PROGRESS status for session sess_1759153998990_641a0f46
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998930_8b48e359 on flight 2439
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998742_de13f424 on flight 6171
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 753 with session sess_1759153999074_84749fc7
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1048
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2782 (leg 2/3)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3943 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1200 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3943 with session sess_1759153999105_95605b7d
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2782 with session sess_1759153998889_0a1ffc97
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1200 with session sess_1759153999085_acbb3636
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6528 and payment ID pay_233d5fc11fb84c9a
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998990_641a0f46. payment ID: pay_233d5fc11fb84c9a
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_233d5fc11fb84c9a, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998930_2a45d823 on flight 141
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7697, 7543], seatCount=1)]
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759153999166_2d6747f7
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2439
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6171
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153998883_53852792 on flight 3624
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998990_5692cc13 on flight 4075
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b74bd24e535a4a54 across 3 flights for session sess_1759153998742_de13f424
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 141
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b31dd1034e8e44bf across 2 flights for session sess_1759153998930_8b48e359
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998889_7c20f381 on flight 3959
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998893_f9ad39b2 on flight 5009
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6529 with IN_PROGRESS status for session sess_1759153998930_8b48e359
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6530 with IN_PROGRESS status for session sess_1759153998742_de13f424
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999049_b82cf4a2 on flight 3196
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999074_84749fc7 on flight 753
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4075
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4213 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4213 with session sess_1759153998990_5692cc13
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999027_c482fa8f on flight 6680
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6529 and payment ID pay_b31dd1034e8e44bf
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998930_8b48e359. payment ID: pay_b31dd1034e8e44bf
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b31dd1034e8e44bf, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5009
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7937 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0ed31c9aae8d4f08 across 2 flights for session sess_1759153998930_2a45d823
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7937 with session sess_1759153998893_f9ad39b2
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[56], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153999215_2e8f210d
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999091_f5806b7e on flight 6292
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6531 with IN_PROGRESS status for session sess_1759153998930_2a45d823
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6680
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5834 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998889_0a1ffc97 on flight 2782
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5834 with session sess_1759153999027_c482fa8f
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 753
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1553 (leg 2/3)
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6530 and payment ID pay_b74bd24e535a4a54
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998742_de13f424. payment ID: pay_b74bd24e535a4a54
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b74bd24e535a4a54, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3624
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6531 and payment ID pay_0ed31c9aae8d4f08
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998930_2a45d823. payment ID: pay_0ed31c9aae8d4f08
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0ed31c9aae8d4f08, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3196
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6257 (leg 2/3)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 3959
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7697 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1710 (leg 3/3)
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1553 with session sess_1759153999074_84749fc7
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7697 with session sess_1759153999166_2d6747f7
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4969, 6650], seatCount=3)]
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153999241_979e3de6
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4338], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759153999242_21d43806
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2782
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 464 (leg 3/3)
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8c9f74b9091148b2 across 2 flights for session sess_1759153998883_53852792
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1710 with session sess_1759153998889_7c20f381
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 464 with session sess_1759153998889_0a1ffc97
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6292
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6257 with session sess_1759153999049_b82cf4a2
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4c112fa295ac42f8 across 1 flights for session sess_1759153999091_f5806b7e
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 56 (leg 1/1)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6532 with IN_PROGRESS status for session sess_1759153999091_f5806b7e
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 56 with session sess_1759153999215_2e8f210d
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6533 with IN_PROGRESS status for session sess_1759153998883_53852792
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999105_95605b7d on flight 3943
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4338 (leg 1/1)
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998990_5692cc13 on flight 4213
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4338 with session sess_1759153999242_21d43806
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999074_84749fc7 on flight 1553
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6532 and payment ID pay_4c112fa295ac42f8
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999091_f5806b7e. payment ID: pay_4c112fa295ac42f8
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4c112fa295ac42f8, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999049_b82cf4a2 on flight 6257
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3943
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 178 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6533 and payment ID pay_8c9f74b9091148b2
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998883_53852792. payment ID: pay_8c9f74b9091148b2
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8c9f74b9091148b2, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4969 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 178 with session sess_1759153999105_95605b7d
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4213
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998893_f9ad39b2 on flight 7937
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4969 with session sess_1759153999241_979e3de6
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999085_acbb3636 on flight 1200
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153998889_7c20f381 on flight 1710
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1553
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6228 (leg 3/3)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_cdc0eef3646147fd across 2 flights for session sess_1759153998990_5692cc13
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6657, 5588, 5357], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153999318_7c07fcf9
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5230, 7262, 926], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153999324_c1bb111e
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6228 with session sess_1759153999074_84749fc7
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6257
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1344 (leg 3/3)
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153998889_0a1ffc97 on flight 464
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999215_2e8f210d on flight 56
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6534 with IN_PROGRESS status for session sess_1759153998990_5692cc13
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999166_2d6747f7 on flight 7697
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1344 with session sess_1759153999049_b82cf4a2
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7937
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e03a4dde608546e0 across 2 flights for session sess_1759153998893_f9ad39b2
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1200
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 656 (leg 2/3)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999242_21d43806 on flight 4338
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6535 with IN_PROGRESS status for session sess_1759153998893_f9ad39b2
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 656 with session sess_1759153999085_acbb3636
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 464
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6534 and payment ID pay_cdc0eef3646147fd
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998990_5692cc13. payment ID: pay_cdc0eef3646147fd
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_cdc0eef3646147fd, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7697
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7543 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999105_95605b7d on flight 178
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_93aa5636e22a4628 across 3 flights for session sess_1759153998889_0a1ffc97
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 56
2025-09-29 19:23:19 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7543 with session sess_1759153999166_2d6747f7
2025-09-29 19:23:19 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999241_979e3de6 on flight 4969
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6536 with IN_PROGRESS status for session sess_1759153998889_0a1ffc97
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4338
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8c5aaed3c5e44289 across 1 flights for session sess_1759153999215_2e8f210d
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6535 and payment ID pay_e03a4dde608546e0
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998893_f9ad39b2. payment ID: pay_e03a4dde608546e0
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e03a4dde608546e0, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4339, 6350], seatCount=3)]
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759153999375_06ca95c6
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1710
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_1894a6b82a824c87 across 3 flights for session sess_1759153998889_7c20f381
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4d0eb3365e004b3c across 1 flights for session sess_1759153999242_21d43806
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6537 with IN_PROGRESS status for session sess_1759153999215_2e8f210d
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 178
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999049_b82cf4a2 on flight 1344
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6657 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8912bdb329d245e3 across 2 flights for session sess_1759153999105_95605b7d
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6538 with IN_PROGRESS status for session sess_1759153999242_21d43806
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4969
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6650 (leg 2/2)
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6810, 5532, 60], seatCount=1)]
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6536 and payment ID pay_93aa5636e22a4628
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998889_0a1ffc97. payment ID: pay_93aa5636e22a4628
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759153999390_966b1605
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_93aa5636e22a4628, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6657 with session sess_1759153999318_7c07fcf9
2025-09-29 19:23:19 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6650 with session sess_1759153999241_979e3de6
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6539 with IN_PROGRESS status for session sess_1759153999105_95605b7d
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999085_acbb3636 on flight 656
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6537 and payment ID pay_8c5aaed3c5e44289
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999215_2e8f210d. payment ID: pay_8c5aaed3c5e44289
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8c5aaed3c5e44289, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6540 with IN_PROGRESS status for session sess_1759153998889_7c20f381
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5230 (leg 1/3)
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1344
2025-09-29 19:23:19 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5230 with session sess_1759153999324_c1bb111e
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999074_84749fc7 on flight 6228
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1804, 7693, 4875], seatCount=3)]
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759153999403_63db54ac
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999027_c482fa8f on flight 5834
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6539 and payment ID pay_8912bdb329d245e3
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999105_95605b7d. payment ID: pay_8912bdb329d245e3
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8912bdb329d245e3, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9cc3c385dd654cc9 across 3 flights for session sess_1759153999049_b82cf4a2
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5946], seatCount=3)]
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153999410_7c5bd36d
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[312], seatCount=3)]
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759153999421_f362f359
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 656
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3705 (leg 3/3)
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6228
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6538 and payment ID pay_4d0eb3365e004b3c
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999242_21d43806. payment ID: pay_4d0eb3365e004b3c
2025-09-29 19:23:19 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3705 with session sess_1759153999085_acbb3636
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4d0eb3365e004b3c, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5834
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6541 with IN_PROGRESS status for session sess_1759153999049_b82cf4a2
2025-09-29 19:23:19 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f61768ee501b4d35 across 3 flights for session sess_1759153999074_84749fc7
2025-09-29 19:23:19 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2460, 45], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759153999457_b7657815
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6540 and payment ID pay_1894a6b82a824c87
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153998889_7c20f381. payment ID: pay_1894a6b82a824c87
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_1894a6b82a824c87, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4411, 2129, 5350], seatCount=2)]
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:19 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759153999606_ffc7d0c9
2025-09-29 19:23:19 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4339 (leg 1/2)
2025-09-29 19:23:19 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ecf8fff5da724841 across 2 flights for session sess_1759153999027_c482fa8f
2025-09-29 19:23:19 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:19 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4339 with session sess_1759153999375_06ca95c6
2025-09-29 19:23:19 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:19 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 312 (leg 1/1)
2025-09-29 19:23:19 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:19 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5946 (leg 1/1)
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6541 and payment ID pay_9cc3c385dd654cc9
2025-09-29 19:23:19 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999049_b82cf4a2. payment ID: pay_9cc3c385dd654cc9
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9cc3c385dd654cc9, fli (truncated)...]
2025-09-29 19:23:19 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:19 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 312 with session sess_1759153999421_f362f359
2025-09-29 19:23:19 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6936, 1884, 7399], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759154000024_e0a1c3e2
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999324_c1bb111e on flight 5230
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6542 with IN_PROGRESS status for session sess_1759153999074_84749fc7
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6543 with IN_PROGRESS status for session sess_1759153999027_c482fa8f
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 5946 with session sess_1759153999410_7c5bd36d
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999166_2d6747f7 on flight 7543
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5230
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7262 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6543 and payment ID pay_ecf8fff5da724841
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999027_c482fa8f. payment ID: pay_ecf8fff5da724841
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ecf8fff5da724841, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6542 and payment ID pay_f61768ee501b4d35
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999074_84749fc7. payment ID: pay_f61768ee501b4d35
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f61768ee501b4d35, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6810 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7262 with session sess_1759153999324_c1bb111e
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999241_979e3de6 on flight 6650
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6810 with session sess_1759153999390_966b1605
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1744, 7450, 142], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759154000159_12b064fd
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6763, 7121, 2651], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759154000170_b9cf292e
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7543
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999318_7c07fcf9 on flight 6657
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_95985aebeff340c4 across 2 flights for session sess_1759153999166_2d6747f7
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999085_acbb3636 on flight 3705
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2460 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6544 with IN_PROGRESS status for session sess_1759153999166_2d6747f7
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1804 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6650
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4411 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999410_7c5bd36d on flight 5946
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1804 with session sess_1759153999403_63db54ac
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_1b025373abfe4959 across 2 flights for session sess_1759153999241_979e3de6
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999421_f362f359 on flight 312
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999375_06ca95c6 on flight 4339
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4411 with session sess_1759153999606_ffc7d0c9
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2460 with session sess_1759153999457_b7657815
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6657
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5588 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5588 with session sess_1759153999318_7c07fcf9
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6545 with IN_PROGRESS status for session sess_1759153999241_979e3de6
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3705
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999324_c1bb111e on flight 7262
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_67a54842756549c1 across 3 flights for session sess_1759153999085_acbb3636
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6544 and payment ID pay_95985aebeff340c4
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999166_2d6747f7. payment ID: pay_95985aebeff340c4
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_95985aebeff340c4, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4339
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6350 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6546 with IN_PROGRESS status for session sess_1759153999085_acbb3636
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6350 with session sess_1759153999375_06ca95c6
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 5946
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_594524e927ed47d0 across 1 flights for session sess_1759153999410_7c5bd36d
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999390_966b1605 on flight 6810
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7262
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 926 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[3221, 6292, 1971], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000290_5a269db2
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6547 with IN_PROGRESS status for session sess_1759153999410_7c5bd36d
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 312
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6936 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b8de3ee085c54893 across 1 flights for session sess_1759153999421_f362f359
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 926 with session sess_1759153999324_c1bb111e
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6763 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6545 and payment ID pay_1b025373abfe4959
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999241_979e3de6. payment ID: pay_1b025373abfe4959
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_1b025373abfe4959, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6548 with IN_PROGRESS status for session sess_1759153999421_f362f359
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6546 and payment ID pay_67a54842756549c1
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999085_acbb3636. payment ID: pay_67a54842756549c1
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_67a54842756549c1, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6810
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5532 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6763 with session sess_1759154000170_b9cf292e
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 6936 with session sess_1759154000024_e0a1c3e2
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5304], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759154000323_3050dd49
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4022, 5593], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759154000326_807bb092
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999318_7c07fcf9 on flight 5588
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5532 with session sess_1759153999390_966b1605
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1744 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5588
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5357 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1744 with session sess_1759154000159_12b064fd
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5357 with session sess_1759153999318_7c07fcf9
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6548 and payment ID pay_b8de3ee085c54893
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999421_f362f359. payment ID: pay_b8de3ee085c54893
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b8de3ee085c54893, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6547 and payment ID pay_594524e927ed47d0
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999410_7c5bd36d. payment ID: pay_594524e927ed47d0
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_594524e927ed47d0, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6164, 4151, 5147], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000376_78359a97
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3221 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7359, 6646, 4770], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000385_a1940d6f
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3221 with session sess_1759154000290_5a269db2
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5304 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5304 with session sess_1759154000323_3050dd49
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4022 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4022 with session sess_1759154000326_807bb092
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000024_e0a1c3e2 on flight 6936
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999375_06ca95c6 on flight 6350
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999606_ffc7d0c9 on flight 4411
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000170_b9cf292e on flight 6763
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999318_7c07fcf9 on flight 5357
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999457_b7657815 on flight 2460
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000323_3050dd49 on flight 5304
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999390_966b1605 on flight 5532
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 6936
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1884 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999403_63db54ac on flight 1804
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1884 with session sess_1759154000024_e0a1c3e2
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6350
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000326_807bb092 on flight 4022
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9be7a6793fda4928 across 2 flights for session sess_1759153999375_06ca95c6
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4411
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000159_12b064fd on flight 1744
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2129 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2460
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 45 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2129 with session sess_1759153999606_ffc7d0c9
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999324_c1bb111e on flight 926
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5357
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5304
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6763
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000290_5a269db2 on flight 3221
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7121 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6549 with IN_PROGRESS status for session sess_1759153999375_06ca95c6
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 45 with session sess_1759153999457_b7657815
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7121 with session sess_1759154000170_b9cf292e
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6164 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f4b2fdd679744b8d across 3 flights for session sess_1759153999318_7c07fcf9
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_db5e083c99d54bee across 1 flights for session sess_1759154000323_3050dd49
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1804
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7693 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6164 with session sess_1759154000376_78359a97
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7693 with session sess_1759153999403_63db54ac
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5532
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 60 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4022
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5593 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6550 with IN_PROGRESS status for session sess_1759154000323_3050dd49
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 60 with session sess_1759153999390_966b1605
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5593 with session sess_1759154000326_807bb092
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3221
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6292 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6551 with IN_PROGRESS status for session sess_1759153999318_7c07fcf9
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6549 and payment ID pay_9be7a6793fda4928
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999375_06ca95c6. payment ID: pay_9be7a6793fda4928
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9be7a6793fda4928, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7359 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6292 with session sess_1759154000290_5a269db2
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1744
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7450 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7450 with session sess_1759154000159_12b064fd
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7359 with session sess_1759154000385_a1940d6f
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 926
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6550 and payment ID pay_db5e083c99d54bee
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6551 and payment ID pay_f4b2fdd679744b8d
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000323_3050dd49. payment ID: pay_db5e083c99d54bee
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999318_7c07fcf9. payment ID: pay_f4b2fdd679744b8d
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f4b2fdd679744b8d, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_db5e083c99d54bee, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4181, 2652], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 3 seats for session sess_1759154000543_c08ffb93
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999457_b7657815 on flight 45
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2980, 1349, 3780], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[5034], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000557_cafc78da
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759154000557_b255d9e7
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_14dcb757697f49ca across 3 flights for session sess_1759153999324_c1bb111e
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 45
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4e3192174ac24c0a across 2 flights for session sess_1759153999457_b7657815
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000376_78359a97 on flight 6164
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5034 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 5034 with session sess_1759154000557_b255d9e7
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999606_ffc7d0c9 on flight 2129
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000170_b9cf292e on flight 7121
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6552 with IN_PROGRESS status for session sess_1759153999457_b7657815
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000024_e0a1c3e2 on flight 1884
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999403_63db54ac on flight 7693
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6553 with IN_PROGRESS status for session sess_1759153999324_c1bb111e
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4181 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6164
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000326_807bb092 on flight 5593
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4151 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4151 with session sess_1759154000376_78359a97
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1884
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7399 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4181 with session sess_1759154000543_c08ffb93
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7399 with session sess_1759154000024_e0a1c3e2
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6552 and payment ID pay_4e3192174ac24c0a
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999457_b7657815. payment ID: pay_4e3192174ac24c0a
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4e3192174ac24c0a, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6553 and payment ID pay_14dcb757697f49ca
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999324_c1bb111e. payment ID: pay_14dcb757697f49ca
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_14dcb757697f49ca, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7693
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4875 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7121
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2651 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4875 with session sess_1759153999403_63db54ac
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2651 with session sess_1759154000170_b9cf292e
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5593
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2333, 908], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759154000634_08acebc5
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_b6b7ef4a4d6f4808 across 2 flights for session sess_1759154000326_807bb092
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2129
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5350 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1410], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759154000639_0cce42da
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6554 with IN_PROGRESS status for session sess_1759154000326_807bb092
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000557_b255d9e7 on flight 5034
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5350 with session sess_1759153999606_ffc7d0c9
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000385_a1940d6f on flight 7359
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2980 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2980 with session sess_1759154000557_cafc78da
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 5034
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1410 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ebb1f46ad3c940ab across 1 flights for session sess_1759154000557_b255d9e7
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7359
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000290_5a269db2 on flight 6292
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6646 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6554 and payment ID pay_b6b7ef4a4d6f4808
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000326_807bb092. payment ID: pay_b6b7ef4a4d6f4808
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_b6b7ef4a4d6f4808, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6646 with session sess_1759154000385_a1940d6f
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 1410 with session sess_1759154000639_0cce42da
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000543_c08ffb93 on flight 4181
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2333 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6555 with IN_PROGRESS status for session sess_1759154000557_b255d9e7
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2333 with session sess_1759154000634_08acebc5
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000159_12b064fd on flight 7450
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4253, 890], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759154000683_18c72f05
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6292
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1971 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000170_b9cf292e on flight 2651
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000376_78359a97 on flight 4151
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759153999390_966b1605 on flight 60
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759153999403_63db54ac on flight 4875
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7450
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6555 and payment ID pay_ebb1f46ad3c940ab
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4181
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 142 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000557_b255d9e7. payment ID: pay_ebb1f46ad3c940ab
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2652 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ebb1f46ad3c940ab, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 142 with session sess_1759154000159_12b064fd
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 2652 with session sess_1759154000543_c08ffb93
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4151
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5147 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5147 with session sess_1759154000376_78359a97
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4875
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2651
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0856bd9c125e4db9 across 3 flights for session sess_1759154000170_b9cf292e
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[970], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759154000703_da53ef64
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6556 with IN_PROGRESS status for session sess_1759154000170_b9cf292e
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1971 with session sess_1759154000290_5a269db2
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000557_cafc78da on flight 2980
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000024_e0a1c3e2 on flight 7399
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 60
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_d7ec1ff119b144cd across 3 flights for session sess_1759153999403_63db54ac
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6557 with IN_PROGRESS status for session sess_1759153999403_63db54ac
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2980
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1349 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1349 with session sess_1759154000557_cafc78da
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ac69bffa264a4bd8 across 3 flights for session sess_1759153999390_966b1605
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7399
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000159_12b064fd on flight 142
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000385_a1940d6f on flight 6646
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e9554c6e71d34292 across 3 flights for session sess_1759154000024_e0a1c3e2
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6557 and payment ID pay_d7ec1ff119b144cd
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999403_63db54ac. payment ID: pay_d7ec1ff119b144cd
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_d7ec1ff119b144cd, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6558 with IN_PROGRESS status for session sess_1759153999390_966b1605
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6559 with IN_PROGRESS status for session sess_1759154000024_e0a1c3e2
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6556 and payment ID pay_0856bd9c125e4db9
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000170_b9cf292e. payment ID: pay_0856bd9c125e4db9
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0856bd9c125e4db9, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6646
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4770 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 142
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_9ec521c5275c4457 across 3 flights for session sess_1759154000159_12b064fd
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4770 with session sess_1759154000385_a1940d6f
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6560 with IN_PROGRESS status for session sess_1759154000159_12b064fd
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6559 and payment ID pay_e9554c6e71d34292
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000024_e0a1c3e2. payment ID: pay_e9554c6e71d34292
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e9554c6e71d34292, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4253 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[175], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 1 seats for session sess_1759154000749_bfc69208
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4253 with session sess_1759154000683_18c72f05
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7787, 4607, 4149], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759154000751_18298ac5
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6558 and payment ID pay_ac69bffa264a4bd8
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999390_966b1605. payment ID: pay_ac69bffa264a4bd8
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ac69bffa264a4bd8, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[418], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759154000759_739d81af
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1204, 7584, 5056], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6560 and payment ID pay_9ec521c5275c4457
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000767_8ad0c1d1
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000376_78359a97 on flight 5147
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000159_12b064fd. payment ID: pay_9ec521c5275c4457
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_9ec521c5275c4457, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000639_0cce42da on flight 1410
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759153999606_ffc7d0c9 on flight 5350
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 970 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 970 with session sess_1759154000703_da53ef64
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 175 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 418 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7272], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759154000782_f1b94e7e
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000634_08acebc5 on flight 2333
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000385_a1940d6f on flight 4770
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5147
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 418 with session sess_1759154000759_739d81af
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000290_5a269db2 on flight 1971
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 175 with session sess_1759154000749_bfc69208
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5350
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 1410
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_0e8667f18a034b21 across 3 flights for session sess_1759154000376_78359a97
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_4ac36283a43f4454 across 3 flights for session sess_1759153999606_ffc7d0c9
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000683_18c72f05 on flight 4253
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_266401f1ea844eca across 1 flights for session sess_1759154000639_0cce42da
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6561 with IN_PROGRESS status for session sess_1759154000376_78359a97
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6562 with IN_PROGRESS status for session sess_1759153999606_ffc7d0c9
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4770
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7272 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6563 with IN_PROGRESS status for session sess_1759154000639_0cce42da
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5ed456091ddc4d6a across 3 flights for session sess_1759154000385_a1940d6f
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2333
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1971
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 908 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4253
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 890 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7443cd4d8df842ff across 3 flights for session sess_1759154000290_5a269db2
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 908 with session sess_1759154000634_08acebc5
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7272 with session sess_1759154000782_f1b94e7e
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 890 with session sess_1759154000683_18c72f05
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6564 with IN_PROGRESS status for session sess_1759154000385_a1940d6f
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6561 and payment ID pay_0e8667f18a034b21
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000376_78359a97. payment ID: pay_0e8667f18a034b21
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_0e8667f18a034b21, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6565 with IN_PROGRESS status for session sess_1759154000290_5a269db2
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000703_da53ef64 on flight 970
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6563 and payment ID pay_266401f1ea844eca
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000639_0cce42da. payment ID: pay_266401f1ea844eca
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_266401f1ea844eca, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000543_c08ffb93 on flight 2652
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6564 and payment ID pay_5ed456091ddc4d6a
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1204 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000385_a1940d6f. payment ID: pay_5ed456091ddc4d6a
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4660, 2053, 1740], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000830_8b63b3c2
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5ed456091ddc4d6a, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000749_bfc69208 on flight 175
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6565 and payment ID pay_7443cd4d8df842ff
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 970
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7787 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000290_5a269db2. payment ID: pay_7443cd4d8df842ff
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7443cd4d8df842ff, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6562 and payment ID pay_4ac36283a43f4454
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759153999606_ffc7d0c9. payment ID: pay_4ac36283a43f4454
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_4ac36283a43f4454, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[7368, 3669], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759154000837_55baef8f
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1204 with session sess_1759154000767_8ad0c1d1
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000759_739d81af on flight 418
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8de5b7d6ea114771 across 1 flights for session sess_1759154000703_da53ef64
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 7787 with session sess_1759154000751_18298ac5
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 175
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000557_cafc78da on flight 1349
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4578, 4007, 6928], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154000844_df7f7e94
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1434], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759154000847_bb9e4a06
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e8eb0d932c844fae across 1 flights for session sess_1759154000749_bfc69208
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4488, 3168], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759154000848_e1a0d89a
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 418
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6566 with IN_PROGRESS status for session sess_1759154000703_da53ef64
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000634_08acebc5 on flight 908
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6567 with IN_PROGRESS status for session sess_1759154000749_bfc69208
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_57ce89a538a14ae0 across 1 flights for session sess_1759154000759_739d81af
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1349
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3780 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3780 with session sess_1759154000557_cafc78da
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 908
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6568 with IN_PROGRESS status for session sess_1759154000759_739d81af
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1434 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000782_f1b94e7e on flight 7272
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6566 and payment ID pay_8de5b7d6ea114771
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000703_da53ef64. payment ID: pay_8de5b7d6ea114771
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8de5b7d6ea114771, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_e9a5c14ae8d44f80 across 2 flights for session sess_1759154000634_08acebc5
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 1 seat holds, ticket 6567 and payment ID pay_e8eb0d932c844fae
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1434 with session sess_1759154000847_bb9e4a06
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 2652
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000749_bfc69208. payment ID: pay_e8eb0d932c844fae
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e8eb0d932c844fae, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5a3b7fe624ad4f99 across 2 flights for session sess_1759154000543_c08ffb93
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000683_18c72f05 on flight 890
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6569 with IN_PROGRESS status for session sess_1759154000634_08acebc5
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4049, 4251], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759154000888_9293e32a
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7368 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6568 and payment ID pay_57ce89a538a14ae0
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7368 with session sess_1759154000837_55baef8f
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000767_8ad0c1d1 on flight 1204
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000759_739d81af. payment ID: pay_57ce89a538a14ae0
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_57ce89a538a14ae0, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[319], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 3 seats for session sess_1759154000896_5a3ba285
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6570 with IN_PROGRESS status for session sess_1759154000543_c08ffb93
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1106, 1130, 6267], seatCount=3)]
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759154000906_52762968
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 890
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4488 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_8ec7e4b995814d57 across 2 flights for session sess_1759154000683_18c72f05
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4660 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6569 and payment ID pay_e9a5c14ae8d44f80
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000634_08acebc5. payment ID: pay_e9a5c14ae8d44f80
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_e9a5c14ae8d44f80, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4488 with session sess_1759154000848_e1a0d89a
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 319 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000751_18298ac5 on flight 7787
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6571 with IN_PROGRESS status for session sess_1759154000683_18c72f05
2025-09-29 19:23:20 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4660 with session sess_1759154000830_8b63b3c2
2025-09-29 19:23:20 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7272
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 6 seat holds, ticket 6570 and payment ID pay_5a3b7fe624ad4f99
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1204
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7584 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000543_c08ffb93. payment ID: pay_5a3b7fe624ad4f99
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5a3b7fe624ad4f99, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 319 with session sess_1759154000896_5a3ba285
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4578 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 7584 with session sess_1759154000767_8ad0c1d1
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5ee3ce8cbac94253 across 1 flights for session sess_1759154000782_f1b94e7e
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4676, 3253], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759154000931_d9e30b12
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4049 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000847_bb9e4a06 on flight 1434
2025-09-29 19:23:20 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4578 with session sess_1759154000844_df7f7e94
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[127, 4676, 2219], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 1 seats for session sess_1759154000937_774aabfe
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4049 with session sess_1759154000888_9293e32a
2025-09-29 19:23:20 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000837_55baef8f on flight 7368
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6572 with IN_PROGRESS status for session sess_1759154000782_f1b94e7e
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6571 and payment ID pay_8ec7e4b995814d57
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000683_18c72f05. payment ID: pay_8ec7e4b995814d57
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_8ec7e4b995814d57, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000557_cafc78da on flight 3780
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 7787
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4607 (leg 2/3)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1351], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759154000956_3b9fac78
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4607 with session sess_1759154000751_18298ac5
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1434
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6572 and payment ID pay_5ee3ce8cbac94253
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000782_f1b94e7e. payment ID: pay_5ee3ce8cbac94253
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5ee3ce8cbac94253, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7368
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3669 (leg 2/2)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1106 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_5519dbc878f44976 across 1 flights for session sess_1759154000847_bb9e4a06
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 3669 with session sess_1759154000837_55baef8f
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1106 with session sess_1759154000906_52762968
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6573 with IN_PROGRESS status for session sess_1759154000847_bb9e4a06
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[2544, 7316], seatCount=1)]
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 1 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 1 seats for session sess_1759154000970_88d5ee7f
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3780
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3816599a0302453e across 3 flights for session sess_1759154000557_cafc78da
2025-09-29 19:23:20 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1351 (leg 1/1)
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4676 (leg 1/2)
2025-09-29 19:23:20 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000767_8ad0c1d1 on flight 7584
2025-09-29 19:23:20 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1351 with session sess_1759154000956_3b9fac78
2025-09-29 19:23:20 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6574 with IN_PROGRESS status for session sess_1759154000557_cafc78da
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6573 and payment ID pay_5519dbc878f44976
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000847_bb9e4a06. payment ID: pay_5519dbc878f44976
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:20 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_5519dbc878f44976, fli (truncated)...]
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:20 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000896_5a3ba285 on flight 319
2025-09-29 19:23:20 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4676 with session sess_1759154000931_d9e30b12
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000848_e1a0d89a on flight 4488
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000751_18298ac5 on flight 4607
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 7584
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 5056 (leg 3/3)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 127 (leg 1/3)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1917, 2237], seatCount=2)]
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Received booking initiation request: 2 flights for 2 passengers
2025-09-29 19:23:20 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Initiating booking for 2 flights with 2 seats for session sess_1759154000994_4b75a390
2025-09-29 19:23:20 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 5056 with session sess_1759154000767_8ad0c1d1
2025-09-29 19:23:20 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 127 with session sess_1759154000937_774aabfe
2025-09-29 19:23:20 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:20 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:20 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:20 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000906_52762968 on flight 1106
2025-09-29 19:23:20 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2544 (leg 1/2)
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6574 and payment ID pay_3816599a0302453e
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000557_cafc78da. payment ID: pay_3816599a0302453e
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3816599a0302453e, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000844_df7f7e94 on flight 4578
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2544 with session sess_1759154000970_88d5ee7f
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000837_55baef8f on flight 3669
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 319
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4488
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3168 (leg 2/2)
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4607
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4149 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_a1341b2c2c0548a1 across 1 flights for session sess_1759154000896_5a3ba285
2025-09-29 19:23:21 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3168 with session sess_1759154000848_e1a0d89a
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1106
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1130 (leg 2/3)
2025-09-29 19:23:21 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4149 with session sess_1759154000751_18298ac5
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4578
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4007 (leg 2/3)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[1662, 6106, 4480], seatCount=3)]
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 3 passengers
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 3 seats for session sess_1759154001013_cd1f81f7
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1130 with session sess_1759154000906_52762968
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6575 with IN_PROGRESS status for session sess_1759154000896_5a3ba285
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4007 with session sess_1759154000844_df7f7e94
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000830_8b63b3c2 on flight 4660
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 3669
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1917 (leg 1/2)
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_ae004504da5f46e0 across 2 flights for session sess_1759154000837_55baef8f
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1917 with session sess_1759154000994_4b75a390
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 3 seat holds, ticket 6575 and payment ID pay_a1341b2c2c0548a1
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000896_5a3ba285. payment ID: pay_a1341b2c2c0548a1
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_a1341b2c2c0548a1, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-10] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000767_8ad0c1d1 on flight 5056
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6576 with IN_PROGRESS status for session sess_1759154000837_55baef8f
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000970_88d5ee7f on flight 2544
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[6311, 6155, 3254], seatCount=2)]
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Received booking initiation request: 3 flights for 2 passengers
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Initiating booking for 3 flights with 2 seats for session sess_1759154001066_f95f3081
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4660
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2053 (leg 2/3)
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-9] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000848_e1a0d89a on flight 3168
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000888_9293e32a on flight 4049
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000931_d9e30b12 on flight 4676
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000937_774aabfe on flight 127
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000844_df7f7e94 on flight 4007
2025-09-29 19:23:21 [http-nio-8080-exec-12] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000751_18298ac5 on flight 4149
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2053 with session sess_1759154000830_8b63b3c2
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000906_52762968 on flight 1130
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 5056
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6576 and payment ID pay_ae004504da5f46e0
2025-09-29 19:23:21 [http-nio-8080-exec-13] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000956_3b9fac78 on flight 1351
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000837_55baef8f. payment ID: pay_ae004504da5f46e0
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_ae004504da5f46e0, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000994_4b75a390 on flight 1917
2025-09-29 19:23:21 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_7c9a8138cc5d4277 across 3 flights for session sess_1759154000767_8ad0c1d1
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - POST "/api/v1/booking/initiate", parameters={}
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestMappingHandlerMapping - Mapped to com.flightbooking.booking.controller.BookingController#initiateBooking(BookingRequest)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.RequestResponseBodyMethodProcessor - Read "application/json;charset=UTF-8" to [BookingRequest(flightIds=[4759], seatCount=2)]
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Received booking initiation request: 1 flights for 2 passengers
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Initiating booking for 1 flights with 2 seats for session sess_1759154001146_7a1b8272
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4676
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3253 (leg 2/2)
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4149
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 127
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4676 (leg 2/3)
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4049
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4251 (leg 2/2)
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2544
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 7316 (leg 2/2)
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000830_8b63b3c2 on flight 2053
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3168
2025-09-29 19:23:21 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_aec5bdac024b442e across 2 flights for session sess_1759154000848_e1a0d89a
2025-09-29 19:23:21 [http-nio-8080-exec-10] INFO  c.f.booking.service.TicketService - Successfully created ticket 6577 with IN_PROGRESS status for session sess_1759154000767_8ad0c1d1
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1130
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4007
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6928 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3253 with session sess_1759154000931_d9e30b12
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6267 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 4676 with session sess_1759154000937_774aabfe
2025-09-29 19:23:21 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_837ec7d904634717 across 3 flights for session sess_1759154000751_18298ac5
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4251 with session sess_1759154000888_9293e32a
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 7316 with session sess_1759154000970_88d5ee7f
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6928 with session sess_1759154000844_df7f7e94
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6267 with session sess_1759154000906_52762968
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1662 (leg 1/3)
2025-09-29 19:23:21 [http-nio-8080-exec-9] INFO  c.f.booking.service.TicketService - Successfully created ticket 6578 with IN_PROGRESS status for session sess_1759154000848_e1a0d89a
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    select
        fi1_0.id,
        fi1_0.arrival_time,
        fi1_0.created_at,
        fi1_0.departure_time,
        fi1_0.destination,
        fi1_0.flight_no,
        fi1_0.price_money,
        fi1_0.source,
        fi1_0.updated_at 
    from
        flight_instance fi1_0 
    where
        fi1_0.id=?
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1351
2025-09-29 19:23:21 [http-nio-8080-exec-12] INFO  c.f.booking.service.TicketService - Successfully created ticket 6579 with IN_PROGRESS status for session sess_1759154000751_18298ac5
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 1662 with session sess_1759154001013_cd1f81f7
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c80d63e17dad4165 across 1 flights for session sess_1759154000956_3b9fac78
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4759 (leg 1/1)
2025-09-29 19:23:21 [http-nio-8080-exec-10] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6577 and payment ID pay_7c9a8138cc5d4277
2025-09-29 19:23:21 [http-nio-8080-exec-10] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000767_8ad0c1d1. payment ID: pay_7c9a8138cc5d4277
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_7c9a8138cc5d4277, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1917
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2237 (leg 2/2)
2025-09-29 19:23:21 [http-nio-8080-exec-10] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2053
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 1740 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 4759 with session sess_1759154001146_7a1b8272
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 2237 with session sess_1759154000994_4b75a390
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-13] INFO  c.f.booking.service.TicketService - Successfully created ticket 6580 with IN_PROGRESS status for session sess_1759154000956_3b9fac78
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 1740 with session sess_1759154000830_8b63b3c2
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-12] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6579 and payment ID pay_837ec7d904634717
2025-09-29 19:23:21 [http-nio-8080-exec-12] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000751_18298ac5. payment ID: pay_837ec7d904634717
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_837ec7d904634717, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-12] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-9] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6578 and payment ID pay_aec5bdac024b442e
2025-09-29 19:23:21 [http-nio-8080-exec-9] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000848_e1a0d89a. payment ID: pay_aec5bdac024b442e
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_aec5bdac024b442e, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-9] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000970_88d5ee7f on flight 7316
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6311 (leg 1/3)
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6311 with session sess_1759154001066_f95f3081
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000844_df7f7e94 on flight 6928
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000888_9293e32a on flight 4251
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000937_774aabfe on flight 4676
2025-09-29 19:23:21 [http-nio-8080-exec-13] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6580 and payment ID pay_c80d63e17dad4165
2025-09-29 19:23:21 [http-nio-8080-exec-13] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000956_3b9fac78. payment ID: pay_c80d63e17dad4165
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c80d63e17dad4165, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-13] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 7316
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000931_d9e30b12 on flight 3253
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_580905d55d744213 across 2 flights for session sess_1759154000970_88d5ee7f
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154000906_52762968 on flight 6267
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6928
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000830_8b63b3c2 on flight 1740
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154001013_cd1f81f7 on flight 1662
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_2fecb3dd91224b6b across 3 flights for session sess_1759154000844_df7f7e94
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.TicketService - Successfully created ticket 6581 with IN_PROGRESS status for session sess_1759154000970_88d5ee7f
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.TicketService - Successfully created ticket 6582 with IN_PROGRESS status for session sess_1759154000844_df7f7e94
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154001066_f95f3081 on flight 6311
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 4676
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 2219 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154001146_7a1b8272 on flight 4759
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4251
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Creating 1 seat holds for flight 2219 with session sess_1759154000937_774aabfe
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3253
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_399f26f3c315430d across 2 flights for session sess_1759154000888_9293e32a
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154000994_4b75a390 on flight 2237
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6267
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_64f98fc479ad412e across 2 flights for session sess_1759154000931_d9e30b12
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_3db9141313f14a48 across 3 flights for session sess_1759154000906_52762968
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 1740
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.booking.service.TicketService - Successfully created ticket 6583 with IN_PROGRESS status for session sess_1759154000888_9293e32a
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_bb672e9ef9a7441c across 3 flights for session sess_1759154000830_8b63b3c2
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 2 seat holds, ticket 6581 and payment ID pay_580905d55d744213
2025-09-29 19:23:21 [http-nio-8080-exec-8] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000970_88d5ee7f. payment ID: pay_580905d55d744213
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_580905d55d744213, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-8] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 1662
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6582 and payment ID pay_2fecb3dd91224b6b
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6106 (leg 2/3)
2025-09-29 19:23:21 [http-nio-8080-exec-5] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000844_df7f7e94. payment ID: pay_2fecb3dd91224b6b
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_2fecb3dd91224b6b, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-5] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.booking.service.TicketService - Successfully created ticket 6584 with IN_PROGRESS status for session sess_1759154000931_d9e30b12
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 4759
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.TicketService - Successfully created ticket 6585 with IN_PROGRESS status for session sess_1759154000830_8b63b3c2
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f6927507085a4282 across 1 flights for session sess_1759154001146_7a1b8272
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6311
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 6155 (leg 2/3)
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.TicketService - Successfully created ticket 6586 with IN_PROGRESS status for session sess_1759154001146_7a1b8272
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 6106 with session sess_1759154001013_cd1f81f7
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.TicketService - Successfully created ticket 6587 with IN_PROGRESS status for session sess_1759154000906_52762968
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 2237
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6583 and payment ID pay_399f26f3c315430d
2025-09-29 19:23:21 [http-nio-8080-exec-11] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000888_9293e32a. payment ID: pay_399f26f3c315430d
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_399f26f3c315430d, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-11] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 6155 with session sess_1759154001066_f95f3081
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6584 and payment ID pay_64f98fc479ad412e
2025-09-29 19:23:21 [http-nio-8080-exec-4] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000931_d9e30b12. payment ID: pay_64f98fc479ad412e
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_64f98fc479ad412e, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-4] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.SeatHoldService - Successfully created 1 seat holds for session sess_1759154000937_774aabfe on flight 2219
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_f7564a0461544ad5 across 2 flights for session sess_1759154000994_4b75a390
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6587 and payment ID pay_3db9141313f14a48
2025-09-29 19:23:21 [http-nio-8080-exec-2] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000906_52762968. payment ID: pay_3db9141313f14a48
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_3db9141313f14a48, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-2] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6585 and payment ID pay_bb672e9ef9a7441c
2025-09-29 19:23:21 [http-nio-8080-exec-14] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000830_8b63b3c2. payment ID: pay_bb672e9ef9a7441c
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.TicketService - Successfully created ticket 6588 with IN_PROGRESS status for session sess_1759154000994_4b75a390
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_bb672e9ef9a7441c, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-14] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 1 flights with 2 seat holds, ticket 6586 and payment ID pay_f6927507085a4282
2025-09-29 19:23:21 [http-nio-8080-exec-15] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154001146_7a1b8272. payment ID: pay_f6927507085a4282
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f6927507085a4282, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-15] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG c.f.booking.service.BookingService - Successfully created 1 seat holds for flight 2219
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_2f2bfa8558534603 across 3 flights for session sess_1759154000937_774aabfe
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 2 flights with 4 seat holds, ticket 6588 and payment ID pay_f7564a0461544ad5
2025-09-29 19:23:21 [http-nio-8080-exec-7] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000994_4b75a390. payment ID: pay_f7564a0461544ad5
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_f7564a0461544ad5, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-7] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.TicketService - Successfully created ticket 6589 with IN_PROGRESS status for session sess_1759154000937_774aabfe
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154001013_cd1f81f7 on flight 6106
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 3 seat holds, ticket 6589 and payment ID pay_2f2bfa8558534603
2025-09-29 19:23:21 [http-nio-8080-exec-1] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154000937_774aabfe. payment ID: pay_2f2bfa8558534603
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_2f2bfa8558534603, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-1] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 6106
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 4480 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Creating 3 seat holds for flight 4480 with session sess_1759154001013_cd1f81f7
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154001066_f95f3081 on flight 6155
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 6155
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Creating seat holds for flight 3254 (leg 3/3)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Creating 2 seat holds for flight 3254 with session sess_1759154001066_f95f3081
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    SELECT
        s.* 
    FROM
        seat s 
    WHERE
        s.flight_instance_id = ? 
        AND s.is_available = true 
        AND NOT EXISTS (SELECT
            1 
        FROM
            seat_hold h 
        WHERE
            h.seat_id = s.id 
            AND h.expires_at > NOW()) 
        AND NOT EXISTS (SELECT
            1 
        FROM
            ticket_seat ts 
        WHERE
            ts.seat_id = s.id) 
    ORDER BY
        s.seat_no 
    LIMIT
        ? FOR UPDATE SKIP LOCKED
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.SeatHoldService - Successfully created 3 seat holds for session sess_1759154001013_cd1f81f7 on flight 4480
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        seat_hold
        (created_at, expires_at, flight_instance_id, holder_session_id, seat_id, version) 
    values
        (?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG c.f.booking.service.BookingService - Successfully created 3 seat holds for flight 4480
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.SeatHoldService - Successfully created 2 seat holds for session sess_1759154001066_f95f3081 on flight 3254
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_c1e0fa97777940fa across 3 flights for session sess_1759154001013_cd1f81f7
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.TicketService - Successfully created ticket 6590 with IN_PROGRESS status for session sess_1759154001013_cd1f81f7
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 9 seat holds, ticket 6590 and payment ID pay_c1e0fa97777940fa
2025-09-29 19:23:21 [http-nio-8080-exec-3] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154001013_cd1f81f7. payment ID: pay_c1e0fa97777940fa
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_c1e0fa97777940fa, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-3] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG c.f.booking.service.BookingService - Successfully created 2 seat holds for flight 3254
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Creating 1 ticket with IN_PROGRESS status for payment ID pay_86333f5f27cd456e across 3 flights for session sess_1759154001066_f95f3081
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG org.hibernate.SQL - 
    insert 
    into
        ticket
        (created_at, flight_instance_id, holder_user_id, payment_id, session_id, status, total_amount, version) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.TicketService - Successfully created ticket 6591 with IN_PROGRESS status for session sess_1759154001066_f95f3081
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.booking.service.BookingService - Successfully initiated booking for 3 flights with 6 seat holds, ticket 6591 and payment ID pay_86333f5f27cd456e
2025-09-29 19:23:21 [http-nio-8080-exec-6] INFO  c.f.b.controller.BookingController - Booking initiated successfully for session: sess_1759154001066_f95f3081. payment ID: pay_86333f5f27cd456e
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Using 'application/json', given [*/*] and supported [application/json, application/*+json]
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.w.s.m.m.a.HttpEntityMethodProcessor - Writing [BookingResponse(status=success, message=Seats successfully held, paymentId=pay_86333f5f27cd456e, fli (truncated)...]
2025-09-29 19:23:21 [http-nio-8080-exec-6] DEBUG o.s.web.servlet.DispatcherServlet - Completed 200 OK
2025-09-29 19:24:38 [SpringApplicationShutdownHook] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Commencing graceful shutdown. Waiting for active requests to complete
2025-09-29 19:24:38 [tomcat-shutdown] INFO  o.s.b.w.e.tomcat.GracefulShutdown - Graceful shutdown complete
2025-09-29 19:24:38 [SpringApplicationShutdownHook] INFO  o.n.driver.internal.InternalDriver - Closing driver instance 2050276103
2025-09-29 19:24:38 [SpringApplicationShutdownHook] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-09-29 19:24:38 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - FlightBookingHikariCP - Shutdown initiated...
2025-09-29 19:24:38 [SpringApplicationShutdownHook] INFO  com.zaxxer.hikari.HikariDataSource - FlightBookingHikariCP - Shutdown completed.
